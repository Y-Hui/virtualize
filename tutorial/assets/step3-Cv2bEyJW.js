import{r as d,j as a}from"./index-ejBbB0ar.js";import{m as F,a as k,A as N}from"./mock-B-WS8Mm5.js";import{c as j}from"./clsx-B-dksMZM.js";function g(o){return"key"in o?o.key:o.dataIndex}function w(o){const{columns:i,onColumnSizesMeasure:s}=o,r=s!=null,u=d.useRef(new Map);return a.jsx("colgroup",{ref:()=>{r&&s(u.current)},children:i.map(c=>{const x=g(c);return a.jsx("col",{ref:m=>{m==null||!r||u.current.set(x,m.offsetWidth)},style:{width:c.width,minWidth:c.minWidth}},x)})})}function E(o){const{columns:i,bodyScrollContainer:s}=o,[r,u]=d.useState(!1),[c,x]=d.useState(!1),m=i.some(t=>t.fixed==="left"),e=i.some(t=>t.fixed==="right");return d.useEffect(()=>{const t=s.current;if(t==null)return;const l=()=>{const{scrollLeft:n,clientWidth:f,scrollWidth:y}=t;m&&u(n!==0),e&&x(!(n+f>=y))};return l(),t.addEventListener("scroll",l),()=>{t.removeEventListener("scroll",l)}},[s,m,e]),{hasFixedLeft:r,hasFixedRight:c}}function L(o){const{columns:i,columnSizes:s}=o,r=d.useMemo(()=>{const e=new Map;return i.reduce((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const n=g(l),f=s.get(n)??0;if(l.fixed==="left")return e.set(n,t),t+f}return t},0),i.reduceRight((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const n=g(l),f=s.get(n)??0;if(l.fixed==="right")return e.set(n,t),t+f}return t},0),e},[s,i]),u=i.reduce((e,t)=>t.fixed==="left"?g(t):e,void 0),c=i.find(e=>e.fixed==="right"),x=c==null?void 0:g(c);return e=>{if(e.fixed!=null&&["left","right"].includes(e.fixed)){const t=g(e),l=e.fixed==="left",n=e.fixed==="right";return{className:j("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":l&&u===t,"virtual-table-cell-fix-right-first":n&&x===t}),style:{left:l?r.get(t):void 0,right:n?r.get(t):void 0}}}return{className:""}}}function R(o,i,s){const{render:r}=s,u=i;if("dataIndex"in s){const c=s.dataIndex;return typeof r!="function"?String(u[c]):r(u[c],i,o)}return(r==null?void 0:r(i,i,o))??null}function z(o){const{rowKey:i,dataSource:s,columns:r}=o,u=d.useRef(null),c=d.useRef(null);d.useEffect(()=>{const n=u.current,f=c.current;if(n==null||f==null)return;const y=[n,f],v=h=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{h()}):h()},b=new Set,C=h=>{const p=h.target;if(b.has(p)){b.delete(p);return}y.forEach(S=>{S!==p&&(b.add(S),v(()=>{S.scrollLeft=p.scrollLeft}))})};return y.forEach(h=>{h.addEventListener("scroll",C)}),()=>{y.forEach(h=>{h.removeEventListener("scroll",C)})}},[]);const[x,m]=d.useState(()=>new Map),{hasFixedLeft:e,hasFixedRight:t}=E({bodyScrollContainer:c,columns:r}),l=L({columns:r,columnSizes:x});return a.jsxs("div",{className:j("virtual-table",e&&"virtual-table-has-fix-left",t&&"virtual-table-has-fix-right"),children:[a.jsx("div",{ref:u,className:"virtual-table-header-wrapper",children:a.jsxs("table",{className:"virtual-table-header-root",children:[a.jsx(w,{columns:r}),a.jsx("thead",{className:"virtual-table-header",children:a.jsx("tr",{children:r.map(n=>{const f=g(n),{className:y,style:v}=l(n);return a.jsx("th",{className:j("virtual-table-header-cell",y),style:v,children:n.title},f)})})})]})}),a.jsx("div",{ref:c,className:"virtual-table-body-wrapper",children:a.jsxs("table",{className:"virtual-table-body-root",children:[a.jsx(w,{columns:r,onColumnSizesMeasure:n=>{m(n)}}),a.jsx("tbody",{className:"virtual-table-body",children:s==null?void 0:s.map((n,f)=>{const y=n,v=y[i];return a.jsx("tr",{children:r.map((b,C)=>{const h=g(b),{className:p,style:S}=l(b);return a.jsx("td",{className:j("virtual-table-cell",p),style:S,children:R(f,y,b)},typeof h=="symbol"?C:h)})},v)})})]})})]})}const D=()=>{const[o,i]=d.useState(100),[s,r]=d.useState(100),[u,c]=d.useState(()=>F(o)),[x,m]=d.useState(()=>k(s,[0,1],[s-1,s-2]));return a.jsxs(a.Fragment,{children:[a.jsx(N,{dataCount:o,onDataCountChange:e=>{i(e),c(F(e))},columnCount:s,onColumnCountChange:e=>{r(e),m(k(e,[0,1],[e-1,e-2]))}}),a.jsx(z,{rowKey:"key",columns:x,dataSource:u})]})};export{D as default};
