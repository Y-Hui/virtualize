var ke=Object.defineProperty;var ve=(n,t,e)=>t in n?ke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Z=(n,t,e)=>ve(n,typeof t!="symbol"?t+"":t,e);import{r as a,j as m}from"./index-BbUG-8SE.js";import{m as se,a as ce,A as Ee}from"./mock-c7wc8XpB.js";import{c as $}from"./clsx-B-dksMZM.js";function le(n){const{columns:t,onColumnSizesMeasure:e}=n,o=e!=null,l=a.useRef(new Map);return m.jsx("colgroup",{ref:()=>{o&&e(l.current)},children:t.map(c=>{const{key:x}=c;if(c.type==="blank")return m.jsx("col",{style:{width:c.width}},x);const{column:p}=c;return m.jsx("col",{ref:r=>{r==null||!o||l.current.set(x,r.offsetWidth)},style:{width:p.width,minWidth:p.minWidth}},x)})})}function L(n,t,e){return typeof t=="function"?t(n,e):n}const G=class G{constructor(t){Z(this,"hooks",[]);this.use=this.use.bind(this),this.setHooks(t)}setHooks(t){this.hooks=t}use(t){if(this.hooks.length===0)return t;const e={current:t},o={render:[],renderContent:[],renderHeaderWrapper:[],renderHeaderRoot:[],renderHeader:[],renderHeaderRow:[],renderHeaderCell:[],renderBodyWrapper:[],renderBodyRoot:[],renderBody:[],renderRow:[],renderCell:[]},l=[],c=[];return this.hooks.slice().forEach(p=>{const r=p(e.current),{render:s,renderContent:i,renderHeaderWrapper:y,renderHeaderRoot:b,renderHeader:I,renderHeaderRow:_,renderHeaderCell:z,renderBodyWrapper:W,renderBodyRoot:N,renderBody:K,renderRow:Y,renderCell:T,rowClassName:h,onRow:g,...R}=r;Object.entries(o).forEach(([F,k])=>{const v=r[F];typeof v=="function"&&k.push(v)}),typeof h=="function"&&l.push(h),typeof g=="function"&&c.push(g),e.current=R}),Object.entries(o).forEach(([p,r])=>{r.length>0&&(e.current[p]=(s,i)=>r.reduce((y,b)=>b(y,i),s))}),l.length>0&&(e.current.rowClassName=(p,r)=>$(...l.map(s=>s(p,r)))),c.length>0&&(e.current.onRow=(p,r)=>c.reduce((s,i)=>({...s,...i(p,r)}),{})),e.current}};Z(G,"defaultInstance",new G([]));let ee=G;function He(n){const{columns:t,bodyScrollContainer:e}=n,[o,l]=a.useState(!1),[c,x]=a.useState(!1),p=t.some(s=>s.fixed==="left"),r=t.some(s=>s.fixed==="right");return a.useEffect(()=>{const s=e.current;if(s==null)return;const i=()=>{const{scrollLeft:y,clientWidth:b,scrollWidth:I}=s;p&&l(y!==0),r&&x(!(y+b>=I))};return i(),s.addEventListener("scroll",i),()=>{s.removeEventListener("scroll",i)}},[e,p,r]),{hasFixedLeft:o,hasFixedRight:c}}function B(n){return"key"in n?n.key:n.dataIndex}function We(n){const{columns:t,columnSizes:e}=n,o=a.useMemo(()=>{const r=new Map;return t.reduce((s,i)=>{if(i.fixed!=null&&["left","right"].includes(i.fixed)){const y=B(i),b=e.get(y)??0;if(i.fixed==="left")return r.set(y,s),s+b}return s},0),t.reduceRight((s,i)=>{if(i.fixed!=null&&["left","right"].includes(i.fixed)){const y=B(i),b=e.get(y)??0;if(i.fixed==="right")return r.set(y,s),s+b}return s},0),r},[e,t]),l=t.reduce((r,s)=>s.fixed==="left"?B(s):r,void 0),c=t.find(r=>r.fixed==="right"),x=c==null?void 0:B(c);return r=>{if(r.fixed!=null&&["left","right"].includes(r.fixed)){const s=B(r),i=r.fixed==="left",y=r.fixed==="right";return{className:$("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":i&&l===s,"virtual-table-cell-fix-right-first":y&&x===s}),style:{left:i?o.get(s):void 0,right:y?o.get(s):void 0}}}return{className:""}}}const Fe=/auto|scroll|overlay|hidden/;function ae(n){return n instanceof Node?n.nodeType===1:!1}function je(n,t=window){let e=n;for(;e!==t&&ae(e);){if(e===document.body)return t;const{overflow:o,overflowY:l,overflowX:c}=window.getComputedStyle(e);if(Fe.test(o+l+c))return e;e=e.parentNode}return n.ownerDocument.defaultView??window}function te(n){return Object.prototype.toString.call(n)==="[object Window]"}function Le(n){return Object.prototype.toString.call(n)==="[object HTMLDocument]"}function Ne(n){return Object.prototype.toString.call(n)==="[object HTMLHtmlElement]"}function Me(n){return Le(n)?n.scrollingElement:ae(n)?n:document.scrollingElement}function De(n,t){let e=0,o=n.length-1,l=-1;for(;e<=o;){const c=Math.floor((e+o)/2);n[c].right>t?(l=c,o=c-1):e=c+1}if(l!==-1)return n[l]}function Be(n){let t=-1;for(let e=n.length-1;e>=0&&n[e].fixed==="right";e--)t=e;return t}function Ie(n){let t=-1;for(let e=0;e<n.length;e+=1)n[e].fixed==="left"&&(t=e);return t}function ie(n){const t=a.useRef(null);return a.useLayoutEffect(()=>{t.current=n},[n]),a.useCallback((...o)=>{var l;return(l=t.current)==null?void 0:l.call(t,...o)},[])}function _e(n){const{estimateSize:t,overscan:e,columns:o,bodyWrapper:l,columnWidths:c,disabled:x}=n,p=a.useMemo(()=>{if(x)return[];let u=0;return o.map((d,f)=>{const w=B(d),q=c.get(w)??t,A=u+q,j={index:f,width:q,left:u,right:A};return u=A,j})},[o,c,t,x]),r=Ie(o),s=Be(o),i=r>-1?B(o[r]):null,y=s>-1?B(o[s]):null,[b,I]=a.useState(0),[_,z]=a.useState(0),W=a.useMemo(()=>{if(x)return o;const u=[...o.slice(0,r+1),...o.slice(b,_),...o.slice(s)],d=new Set;return u.filter(f=>{const w=B(f);return d.has(w)?!1:(d.add(w),!0)})},[x,o,b,_,r,s]),N=(u,d)=>p.slice(u,d).reduce((f,w)=>f+w.width,0),K=r>-1?N(0,r+1):0,Y=s>-1?N(s):0,T=Math.max(0,N(0,b)-K),h=Math.max(0,N(_)-Y),g=a.useMemo(()=>W.reduce((u,d,f)=>{const w=B(d);return w===i?(u.push({type:"normal",key:w,column:d}),u.push({type:"blank",key:"_blank_left",width:T})):i==null&&f===0?(u.push({type:"blank",key:"_blank_left",width:T}),u.push({type:"normal",key:w,column:d})):w===y?(u.push({type:"blank",key:"_blank_right",width:h}),u.push({type:"normal",key:w,column:d})):y==null&&f===W.length-1?(u.push({type:"normal",key:w,column:d}),u.push({type:"blank",key:"_blank_right",width:h})):u.push({type:"normal",key:w,column:d}),u},[]),[W,i,y,T,h]),R=a.useRef({index:0,width:t,left:0,right:t}),F=ie(u=>De(p,u)),k=ie((u,d)=>{const f=F(u);f!=null&&(R.current=f,I(Math.max(0,f.index-e)),z(f.index+d+e))}),v=a.useRef(0);return a.useEffect(()=>{if(x)return;const u=l.current;if(u==null)return;const d=u.offsetWidth;let f=Math.ceil(d/t);const w=j=>{f=Math.ceil(j/t)},q=()=>te(u)?{width:window.innerWidth,height:window.innerHeight}:{width:u.offsetWidth,height:u.offsetHeight},A=()=>{const j=u.scrollLeft;j>v.current?j>R.current.right&&k(j,f):j<R.current.left&&k(j,f),v.current=j};return u.addEventListener("scroll",A),w(q().width),k(u.scrollLeft,f),()=>{u.removeEventListener("scroll",A)}},[l,t,e,x,k]),{columns:W,descriptor:g}}function ze(n,t){let e=0,o=n.length-1,l=-1;for(;e<=o;){const c=Math.floor((e+o)/2);n[c].bottom>t?(l=c,o=c-1):e=c+1}if(l!==-1)return n[l]}function Te(n){const{dataSource:t,estimateSize:e,getScrollContainer:o,overscan:l=0}=n,[c,x]=a.useState(0),[p,r]=a.useState(0),s=a.useMemo(()=>{if(t!=null)return t.slice(c,p)},[t,p,c]),i=a.useRef([]);(()=>{const h=(t==null?void 0:t.length)??0;for(let g=0;g<h;g++)i.current[g]==null&&(i.current[g]=e);i.current=i.current.slice(0,h)})();const b=a.useRef([]),I=(h=!1)=>{if(h&&b.current.length>0)return;const{rects:g}=i.current.reduce((R,F,k)=>{const v=R.top+F;return R.rects.push({index:k,top:R.top,height:F,bottom:v}),R.top=v,R},{top:0,rects:[]});b.current=g},_=a.useCallback((h,g)=>{const R=i.current[h];i.current[h]=g,I(R===g)},[]),z=a.useRef({index:0,height:e,top:0,bottom:e}),W=a.useRef(!1),N=a.useRef(0);a.useEffect(()=>{const h=o();if(h==null)return;let g=0;const R=d=>{g=Math.ceil(d/e)},F=()=>te(h)?{width:window.innerWidth,height:window.innerHeight}:{width:h.offsetWidth,height:h.offsetHeight},k=()=>{let d=0;return te(h)||Ne(h)?d=window.scrollY:d=Me(h).scrollTop,Math.max(d,0)};if(R(F().height),!W.current){W.current=!0;const d=k();let f=0;d>=e&&(f=Math.max(Math.floor(d/e)-1-l,0));const w=f+g+l;x(f),r(w)}const v=d=>{const f=ze(b.current,d);f!=null&&(z.current=f,x(Math.max(0,f.index-l)),r(f.index+g+l))},u=()=>{const d=k();d>N.current?d>z.current.bottom&&v(d):d<z.current.top&&v(d),N.current=d};return h.addEventListener("scroll",u),()=>{h.removeEventListener("scroll",u)}},[e,o,l]);const K=(h,g)=>i.current.slice(h,g).reduce((R,F)=>R+F,0),Y=K(0,c),T=K(p);return{dataSource:s,startIndex:c,topBlank:Y,bottomBlank:T,updateRowHeight:_}}function Ke(n,t,e){const{render:o}=e,l=t;if("dataIndex"in e){const c=e.dataIndex;return typeof o!="function"?String(l[c]):o(l[c],t,n)}return(o==null?void 0:o(t,t,n))??null}function Ae(n){const{rowKey:t,dataSource:e,columns:o,estimatedRowHeight:l=40,estimatedColumnWidth:c,pipeline:x=ee.defaultInstance}=n,p=a.useRef(null),r=a.useCallback(()=>{const S=p.current;if(S!=null)return je(S)},[]),s=a.useRef(null),i=a.useRef(null),y=a.useRef(null),b=a.useRef(null),{dataSource:I,columns:_,rowKey:z,rowClassName:W,render:N,renderContent:K,renderHeaderWrapper:Y,renderHeaderRoot:T,renderHeader:h,renderHeaderRow:g,renderHeaderCell:R,renderBodyWrapper:F,renderBodyRoot:k,renderBody:v,renderRow:u,renderCell:d,onRow:f}=x.use({dataSource:e??[],columns:o,rowKey:t,estimatedRowHeight:l,rootRef:p,headerWrapperRef:s,bodyWrapperRef:i,bodyRootRef:y,bodyRef:b,getScroller:r}),{dataSource:w,topBlank:q,bottomBlank:A,startIndex:j,updateRowHeight:ne}=Te({dataSource:I,estimateSize:l,overscan:5,getScrollContainer:r});a.useEffect(()=>{const S=s.current,O=i.current;if(S==null||O==null)return;const H=[S,O],P=M=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{M()}):M()},V=new Set,Q=M=>{const X=M.target;if(V.has(X)){V.delete(X);return}H.forEach(D=>{D!==X&&(V.add(D),P(()=>{D.scrollLeft=X.scrollLeft}))})};return H.forEach(M=>{M.addEventListener("scroll",Q)}),()=>{H.forEach(M=>{M.removeEventListener("scroll",Q)})}},[]);const[J,ue]=a.useState(()=>new Map),{columns:E,descriptor:C}=_e({estimateSize:c??100,overscan:3,columns:_,bodyWrapper:i,columnWidths:J,disabled:c==null}),{hasFixedLeft:de,hasFixedRight:fe}=He({bodyScrollContainer:i,columns:E}),re=We({columns:E,columnSizes:J}),he=L(m.jsx("tr",{children:C.map(S=>{const{key:O}=S;if(S.type==="blank")return m.jsx("th",{},O);const{column:H}=S,{className:P,style:V}=re(H),Q=m.jsx("th",{className:$("virtual-table-header-cell",P),style:V,children:H.title},O);return L(Q,R,{columns:E,columnDescriptor:C,column:H,columnWidths:J})})}),g,{columns:E,columnDescriptor:C}),pe=L(m.jsx("thead",{className:"virtual-table-header",children:he}),h,{columns:E,columnDescriptor:C}),me=L(m.jsxs("table",{className:"virtual-table-header-root",children:[m.jsx(le,{columns:C}),pe]}),T,{columns:E,columnDescriptor:C}),xe=L(m.jsx("div",{ref:s,className:"virtual-table-header-wrapper",children:me}),Y,{columns:E,columnDescriptor:C}),ye=L(m.jsx("tbody",{ref:b,className:"virtual-table-body",children:w==null?void 0:w.map((S,O)=>{const H=j+O,P=S,V=P[z],{className:Q,...M}=(f==null?void 0:f(S,H))??{},X=a.createElement("tr",{...M,key:V,ref:D=>{D!=null&&ne(H,D.offsetHeight)},className:$(Q,W==null?void 0:W(S,H))},C.map(D=>{const{key:oe}=D;if(D.type==="blank")return m.jsx("td",{},oe);const{column:U}=D,{className:be,style:Se}=re(U),Ce=m.jsx("td",{className:$("virtual-table-cell",be),style:Se,children:Ke(H,P,U)},oe);return L(Ce,d,{column:U})}));return L(X,u,{columns:E,columnDescriptor:C,rowIndex:H,rowData:S})})}),v,{columns:E,columnDescriptor:C}),ge=L(m.jsxs("table",{ref:y,className:"virtual-table-body-root",style:{paddingBottom:A,paddingTop:q},children:[m.jsx(le,{columns:C,onColumnSizesMeasure:S=>{ue(S)}}),ye]}),k,{columns:E,columnDescriptor:C}),we=L(m.jsx("div",{ref:i,className:"virtual-table-body-wrapper",children:ge}),F,{columns:E,columnDescriptor:C}),Re=L(m.jsxs(m.Fragment,{children:[xe,we]}),K,{columns:E,columnDescriptor:C});return L(m.jsx("div",{ref:p,className:$("virtual-table",de&&"virtual-table-has-fix-left",fe&&"virtual-table-has-fix-right"),children:Re}),N,{columns:E,columnDescriptor:C})}const Pe=()=>{const[n,t]=a.useState(1e3),[e,o]=a.useState(1e3),[l,c]=a.useState(()=>se(n)),[x,p]=a.useState(()=>ce(e,[0],[e-1]));return m.jsxs(m.Fragment,{children:[m.jsx(Ee,{dataCount:n,onDataCountChange:r=>{t(r),c(se(r))},columnCount:e,onColumnCountChange:r=>{o(r),p(ce(r,[0],[r-1]))}}),m.jsx(Ae,{rowKey:"key",columns:x,dataSource:l,estimatedRowHeight:40,estimatedColumnWidth:180})]})};export{Pe as default};
