import{r as u,j as h}from"./index-BG0qSOyH.js";import{m as D,a as z,A as K}from"./mock-DREueHtA.js";import{c as H}from"./clsx-B-dksMZM.js";function j(e){return"key"in e?e.key:e.dataIndex}function I(e){const{columns:n,onColumnSizesMeasure:t}=e,r=t!=null,a=u.useRef(new Map);return h.jsx("colgroup",{ref:()=>{r&&t(a.current)},children:n.map(o=>{const y=j(o);return h.jsx("col",{ref:x=>{x==null||!r||a.current.set(y,x.offsetWidth)},style:{width:o.width,minWidth:o.minWidth}},y)})})}function O(e){const{columns:n,bodyScrollContainer:t}=e,[r,a]=u.useState(!1),[o,y]=u.useState(!1),x=n.some(i=>i.fixed==="left"),s=n.some(i=>i.fixed==="right");return u.useEffect(()=>{const i=t.current;if(i==null)return;const c=()=>{const{scrollLeft:S,clientWidth:v,scrollWidth:k}=i;x&&a(S!==0),s&&y(!(S+v>=k))};return c(),i.addEventListener("scroll",c),()=>{i.removeEventListener("scroll",c)}},[t,x,s]),{hasFixedLeft:r,hasFixedRight:o}}function P(e){const{columns:n,columnSizes:t}=e,r=u.useMemo(()=>{const s=new Map;return n.reduce((i,c)=>{if(c.fixed!=null&&["left","right"].includes(c.fixed)){const S=j(c),v=t.get(S)??0;if(c.fixed==="left")return s.set(S,i),i+v}return i},0),n.reduceRight((i,c)=>{if(c.fixed!=null&&["left","right"].includes(c.fixed)){const S=j(c),v=t.get(S)??0;if(c.fixed==="right")return s.set(S,i),i+v}return i},0),s},[t,n]),a=n.reduce((s,i)=>i.fixed==="left"?j(i):s,void 0),o=n.find(s=>s.fixed==="right"),y=o==null?void 0:j(o);return s=>{if(s.fixed!=null&&["left","right"].includes(s.fixed)){const i=j(s),c=s.fixed==="left",S=s.fixed==="right";return{className:H("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":c&&a===i,"virtual-table-cell-fix-right-first":S&&y===i}),style:{left:c?r.get(i):void 0,right:S?r.get(i):void 0}}}return{className:""}}}const Y=/auto|scroll|overlay|hidden/;function A(e){return e instanceof Node?e.nodeType===1:!1}function _(e,n=window){let t=e;for(;t!==n&&A(t);){if(t===document.body)return n;const{overflow:r,overflowY:a,overflowX:o}=window.getComputedStyle(t);if(Y.test(r+a+o))return t;t=t.parentNode}return e.ownerDocument.defaultView??window}function W(e){return Object.prototype.toString.call(e)==="[object Window]"}function V(e){return Object.prototype.toString.call(e)==="[object HTMLDocument]"}function q(e){return Object.prototype.toString.call(e)==="[object HTMLHtmlElement]"}function Q(e){return V(e)?e.scrollingElement:A(e)?e:document.scrollingElement}function X(e,n){let t=0,r=e.length-1,a=-1;for(;t<=r;){const o=Math.floor((t+r)/2);e[o].bottom>n?(a=o,r=o-1):t=o+1}if(a!==-1)return e[a]}function G(e){const{dataSource:n,estimateSize:t,getScrollContainer:r,overscan:a=0}=e,[o,y]=u.useState(0),[x,s]=u.useState(0),i=u.useMemo(()=>{if(n!=null)return n.slice(o,x)},[n,x,o]),c=u.useRef([]);(()=>{const l=(n==null?void 0:n.length)??0;for(let d=0;d<l;d++)c.current[d]==null&&(c.current[d]=t);c.current=c.current.slice(0,l)})();const v=u.useRef([]),k=(l=!1)=>{if(l&&v.current.length>0)return;const{rects:d}=c.current.reduce((m,g,w)=>{const b=m.top+g;return m.rects.push({index:w,top:m.top,height:g,bottom:b}),m.top=b,m},{top:0,rects:[]});v.current=d},T=u.useCallback((l,d)=>{const m=c.current[l];c.current[l]=d,k(m===d)},[]),N=u.useRef({index:0,height:t,top:0,bottom:t}),L=u.useRef(!1),M=u.useRef(0);u.useEffect(()=>{const l=r();if(l==null)return;let d=0;const m=f=>{d=Math.ceil(f/t)},g=()=>W(l)?{width:window.innerWidth,height:window.innerHeight}:{width:l.offsetWidth,height:l.offsetHeight},w=()=>{let f=0;return W(l)||q(l)?f=window.scrollY:f=Q(l).scrollTop,Math.max(f,0)};if(m(g().height),!L.current){L.current=!0;const f=w();let E=0;f>=t&&(E=Math.max(Math.floor(f/t)-1-a,0));const B=E+d+a;y(E),s(B)}const b=f=>{const E=X(v.current,f);E!=null&&(N.current=E,y(Math.max(0,E.index-a)),s(E.index+d+a))},R=()=>{const f=w();f>M.current?f>N.current.bottom&&b(f):f<N.current.top&&b(f),M.current=f};return l.addEventListener("scroll",R),()=>{l.removeEventListener("scroll",R)}},[t,r,a]);const F=(l,d)=>c.current.slice(l,d).reduce((m,g)=>m+g,0),p=F(0,o),C=F(x);return{dataSource:i,startIndex:o,topBlank:p,bottomBlank:C,updateRowHeight:T}}function J(e,n,t){const{render:r}=t,a=n;if("dataIndex"in t){const o=t.dataIndex;return typeof r!="function"?String(a[o]):r(a[o],n,e)}return(r==null?void 0:r(n,n,e))??null}function U(e){const{rowKey:n,dataSource:t,columns:r,estimatedRowHeight:a=40}=e,o=u.useRef(null),y=u.useCallback(()=>{const p=o.current;if(p!=null)return _(p)},[]),{dataSource:x,topBlank:s,bottomBlank:i,startIndex:c,updateRowHeight:S}=G({dataSource:t,estimateSize:a,overscan:5,getScrollContainer:y}),v=u.useRef(null),k=u.useRef(null);u.useEffect(()=>{const p=v.current,C=k.current;if(p==null||C==null)return;const l=[p,C],d=w=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{w()}):w()},m=new Set,g=w=>{const b=w.target;if(m.has(b)){m.delete(b);return}l.forEach(R=>{R!==b&&(m.add(R),d(()=>{R.scrollLeft=b.scrollLeft}))})};return l.forEach(w=>{w.addEventListener("scroll",g)}),()=>{l.forEach(w=>{w.removeEventListener("scroll",g)})}},[]);const[T,N]=u.useState(()=>new Map),{hasFixedLeft:L,hasFixedRight:M}=O({bodyScrollContainer:k,columns:r}),F=P({columns:r,columnSizes:T});return h.jsxs("div",{ref:o,className:H("virtual-table",L&&"virtual-table-has-fix-left",M&&"virtual-table-has-fix-right"),children:[h.jsx("div",{ref:v,className:"virtual-table-header-wrapper",children:h.jsxs("table",{className:"virtual-table-header-root",children:[h.jsx(I,{columns:r}),h.jsx("thead",{className:"virtual-table-header",children:h.jsx("tr",{children:r.map(p=>{const C=j(p),{className:l,style:d}=F(p);return h.jsx("th",{className:H("virtual-table-header-cell",l),style:d,children:p.title},C)})})})]})}),h.jsx("div",{ref:k,className:"virtual-table-body-wrapper",children:h.jsxs("table",{className:"virtual-table-body-root",style:{paddingBottom:i,paddingTop:s},children:[h.jsx(I,{columns:r,onColumnSizesMeasure:p=>{N(p)}}),h.jsx("tbody",{className:"virtual-table-body",children:x==null?void 0:x.map((p,C)=>{const l=c+C,d=p,m=d[n];return h.jsx("tr",{ref:g=>{g!=null&&S(l,g.offsetHeight)},children:r.map((g,w)=>{const b=j(g),{className:R,style:f}=F(g);return h.jsx("td",{className:H("virtual-table-cell",R),style:f,children:J(l,d,g)},typeof b=="symbol"?w:b)})},m)})})]})})]})}const te=()=>{const[e,n]=u.useState(1e3),[t,r]=u.useState(10),[a,o]=u.useState(()=>D(e)),[y,x]=u.useState(()=>z(t,[0],[t-1]));return h.jsxs(h.Fragment,{children:[h.jsx(K,{dataCount:e,onDataCountChange:s=>{n(s),o(D(s))},columnCount:t,onColumnCountChange:s=>{r(s),x(z(s,[0],[s-1]))}}),h.jsx(U,{rowKey:"key",columns:y,dataSource:a,estimatedRowHeight:40})]})};export{te as default};
