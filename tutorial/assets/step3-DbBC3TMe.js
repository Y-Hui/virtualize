import{r as d,j as a}from"./index-ClCruHti.js";import{m as F,a as k,A as N}from"./mock-C2rsIW0h.js";import{c as j}from"./clsx-B-dksMZM.js";function g(o){return"key"in o?o.key:o.dataIndex}function w(o){const{columns:i,onColumnSizesMeasure:s}=o,n=s!=null,u=d.useRef(new Map);return a.jsx("colgroup",{ref:()=>{n&&s(u.current)},children:i.map((c,y)=>{const h=g(c);return a.jsx("col",{ref:e=>{e==null||!n||u.current.set(h,e.offsetWidth)},style:{width:c.width,minWidth:c.minWidth}},typeof h=="symbol"?y:h)})})}function E(o){const{columns:i,bodyScrollContainer:s}=o,[n,u]=d.useState(!1),[c,y]=d.useState(!1),h=i.some(t=>t.fixed==="left"),e=i.some(t=>t.fixed==="right");return d.useEffect(()=>{const t=s.current;if(t==null)return;const l=()=>{const{scrollLeft:r,clientWidth:f,scrollWidth:x}=t;h&&u(r!==0),e&&y(!(r+f>=x))};return l(),t.addEventListener("scroll",l),()=>{t.removeEventListener("scroll",l)}},[s,h,e]),{hasFixedLeft:n,hasFixedRight:c}}function L(o){const{columns:i,columnSizes:s}=o,n=d.useMemo(()=>{const e=new Map;return i.reduce((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const r=g(l),f=s.get(r)??0;if(l.fixed==="left")return e.set(r,t),t+f}return t},0),i.reduceRight((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const r=g(l),f=s.get(r)??0;if(l.fixed==="right")return e.set(r,t),t+f}return t},0),e},[s,i]),u=i.reduce((e,t)=>t.fixed==="left"?g(t):e,void 0),c=i.find(e=>e.fixed==="right"),y=c==null?void 0:g(c);return e=>{if(e.fixed!=null&&["left","right"].includes(e.fixed)){const t=g(e),l=e.fixed==="left",r=e.fixed==="right";return{className:j("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":l&&u===t,"virtual-table-cell-fix-right-first":r&&y===t}),style:{left:l?n.get(t):void 0,right:r?n.get(t):void 0}}}return{className:""}}}function R(o,i,s){const{render:n}=s,u=i;if("dataIndex"in s){const c=s.dataIndex;return typeof n!="function"?String(u[c]):n(u[c],i,o)}return(n==null?void 0:n(i,i,o))??null}function z(o){const{rowKey:i,dataSource:s,columns:n}=o,u=d.useRef(null),c=d.useRef(null);d.useEffect(()=>{const r=u.current,f=c.current;if(r==null||f==null)return;const x=[r,f],S=m=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{m()}):m()},b=new Set,C=m=>{const p=m.target;if(b.has(p)){b.delete(p);return}x.forEach(v=>{v!==p&&(b.add(v),S(()=>{v.scrollLeft=p.scrollLeft}))})};return x.forEach(m=>{m.addEventListener("scroll",C)}),()=>{x.forEach(m=>{m.removeEventListener("scroll",C)})}},[]);const[y,h]=d.useState(()=>new Map),{hasFixedLeft:e,hasFixedRight:t}=E({bodyScrollContainer:c,columns:n}),l=L({columns:n,columnSizes:y});return a.jsxs("div",{className:j("virtual-table",e&&"virtual-table-has-fix-left",t&&"virtual-table-has-fix-right"),children:[a.jsx("div",{ref:u,className:"virtual-table-header-wrapper",children:a.jsxs("table",{className:"virtual-table-header-root",children:[a.jsx(w,{columns:n}),a.jsx("thead",{className:"virtual-table-header",children:a.jsx("tr",{children:n.map((r,f)=>{const x=g(r),{className:S,style:b}=l(r);return a.jsx("th",{className:j("virtual-table-header-cell",S),style:b,children:r.title},typeof x=="symbol"?f:x)})})})]})}),a.jsx("div",{ref:c,className:"virtual-table-body-wrapper",children:a.jsxs("table",{className:"virtual-table-body-root",children:[a.jsx(w,{columns:n,onColumnSizesMeasure:r=>{h(r)}}),a.jsx("tbody",{className:"virtual-table-body",children:s==null?void 0:s.map((r,f)=>{const x=r,S=x[i];return a.jsx("tr",{children:n.map((b,C)=>{const m=g(b),{className:p,style:v}=l(b);return a.jsx("td",{className:j("virtual-table-cell",p),style:v,children:R(f,x,b)},typeof m=="symbol"?C:m)})},S)})})]})})]})}const D=()=>{const[o,i]=d.useState(100),[s,n]=d.useState(100),[u,c]=d.useState(()=>F(o)),[y,h]=d.useState(()=>k(s,[0,1],[s-1,s-2]));return a.jsxs(a.Fragment,{children:[a.jsx(N,{dataCount:o,onDataCountChange:e=>{i(e),c(F(e))},columnCount:s,onColumnCountChange:e=>{n(e),h(k(e,[0,1],[e-1,e-2]))}}),a.jsx(z,{rowKey:"key",columns:y,dataSource:u})]})};export{D as default};
