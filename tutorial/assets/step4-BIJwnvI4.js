import{r as a,j as m}from"./index-ClCruHti.js";import{m as D,a as z,A as K}from"./mock-C2rsIW0h.js";import{c as H}from"./clsx-B-dksMZM.js";function k(e){return"key"in e?e.key:e.dataIndex}function I(e){const{columns:n,onColumnSizesMeasure:t}=e,o=t!=null,c=a.useRef(new Map);return m.jsx("colgroup",{ref:()=>{o&&t(c.current)},children:n.map((r,E)=>{const g=k(r);return m.jsx("col",{ref:s=>{s==null||!o||c.current.set(g,s.offsetWidth)},style:{width:r.width,minWidth:r.minWidth}},typeof g=="symbol"?E:g)})})}function O(e){const{columns:n,bodyScrollContainer:t}=e,[o,c]=a.useState(!1),[r,E]=a.useState(!1),g=n.some(l=>l.fixed==="left"),s=n.some(l=>l.fixed==="right");return a.useEffect(()=>{const l=t.current;if(l==null)return;const u=()=>{const{scrollLeft:x,clientWidth:b,scrollWidth:C}=l;g&&c(x!==0),s&&E(!(x+b>=C))};return u(),l.addEventListener("scroll",u),()=>{l.removeEventListener("scroll",u)}},[t,g,s]),{hasFixedLeft:o,hasFixedRight:r}}function P(e){const{columns:n,columnSizes:t}=e,o=a.useMemo(()=>{const s=new Map;return n.reduce((l,u)=>{if(u.fixed!=null&&["left","right"].includes(u.fixed)){const x=k(u),b=t.get(x)??0;if(u.fixed==="left")return s.set(x,l),l+b}return l},0),n.reduceRight((l,u)=>{if(u.fixed!=null&&["left","right"].includes(u.fixed)){const x=k(u),b=t.get(x)??0;if(u.fixed==="right")return s.set(x,l),l+b}return l},0),s},[t,n]),c=n.reduce((s,l)=>l.fixed==="left"?k(l):s,void 0),r=n.find(s=>s.fixed==="right"),E=r==null?void 0:k(r);return s=>{if(s.fixed!=null&&["left","right"].includes(s.fixed)){const l=k(s),u=s.fixed==="left",x=s.fixed==="right";return{className:H("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":u&&c===l,"virtual-table-cell-fix-right-first":x&&E===l}),style:{left:u?o.get(l):void 0,right:x?o.get(l):void 0}}}return{className:""}}}const Y=/auto|scroll|overlay|hidden/;function A(e){return e instanceof Node?e.nodeType===1:!1}function _(e,n=window){let t=e;for(;t!==n&&A(t);){if(t===document.body)return n;const{overflow:o,overflowY:c,overflowX:r}=window.getComputedStyle(t);if(Y.test(o+c+r))return t;t=t.parentNode}return e.ownerDocument.defaultView??window}function W(e){return Object.prototype.toString.call(e)==="[object Window]"}function V(e){return Object.prototype.toString.call(e)==="[object HTMLDocument]"}function q(e){return Object.prototype.toString.call(e)==="[object HTMLHtmlElement]"}function Q(e){return V(e)?e.scrollingElement:A(e)?e:document.scrollingElement}function X(e,n){let t=0,o=e.length-1,c=-1;for(;t<=o;){const r=Math.floor((t+o)/2);e[r].bottom>n?(c=r,o=r-1):t=r+1}if(c!==-1)return e[c]}function G(e){const{dataSource:n,estimateSize:t,getScrollContainer:o,overscan:c=0}=e,r=a.useRef([]);(()=>{const i=(n==null?void 0:n.length)??0;for(let d=0;d<i;d++)r.current[d]==null&&(r.current[d]=t);r.current=r.current.slice(0,i)})();const g=a.useRef([]),s=(i=!1)=>{if(i&&g.current.length>0)return;const{rects:d}=r.current.reduce((f,p,y)=>{const S=f.top+p;return f.rects.push({index:y,top:f.top,height:p,bottom:S}),f.top=S,f},{top:0,rects:[]});g.current=d},l=a.useCallback((i,d)=>{const f=r.current[i];r.current[i]=d,s(f===d)},[]),u=a.useRef({index:0,height:t,top:0,bottom:t}),[x,b]=a.useState(0),[C,F]=a.useState(0),L=a.useRef(!1),M=a.useRef(0);a.useEffect(()=>{const i=o();if(i==null)return;let d=0;const f=h=>{d=Math.ceil(h/t)},p=()=>W(i)?{width:window.innerWidth,height:window.innerHeight}:{width:i.offsetWidth,height:i.offsetHeight},y=()=>{let h=0;return W(i)||q(i)?h=window.scrollY:h=Q(i).scrollTop,Math.max(h,0)};if(f(p().height),!L.current){L.current=!0;const h=y();let v=0;h>=t&&(v=Math.max(Math.floor(h/t)-1-c,0));const B=v+d+c;b(v),F(B)}const S=h=>{const v=X(g.current,h);v!=null&&(console.log(v),u.current=v,b(Math.max(0,v.index-c)),F(v.index+d+c))},j=()=>{const h=y();h>M.current?h>u.current.bottom&&S(h):h<u.current.top&&S(h),M.current=h};return i.addEventListener("scroll",j),()=>{i.removeEventListener("scroll",j)}},[t,o,c]);const T=a.useMemo(()=>{if(n!=null)return n.slice(x,C)},[n,C,x]),N=(i,d)=>r.current.slice(i,d).reduce((f,p)=>f+p,0),w=N(0,x),R=N(C);return{dataSource:T,startIndex:x,topBlank:w,bottomBlank:R,updateRowHeight:l}}function J(e,n,t){const{render:o}=t,c=n;if("dataIndex"in t){const r=t.dataIndex;return typeof o!="function"?String(c[r]):o(c[r],n,e)}return(o==null?void 0:o(n,n,e))??null}function U(e){const{rowKey:n,dataSource:t,columns:o,estimatedRowHeight:c=40}=e,r=a.useRef(null),E=a.useCallback(()=>{const w=r.current;if(w!=null)return _(w)},[]),{dataSource:g,topBlank:s,bottomBlank:l,startIndex:u,updateRowHeight:x}=G({dataSource:t,estimateSize:c,overscan:5,getScrollContainer:E}),b=a.useRef(null),C=a.useRef(null);a.useEffect(()=>{const w=b.current,R=C.current;if(w==null||R==null)return;const i=[w,R],d=y=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{y()}):y()},f=new Set,p=y=>{const S=y.target;if(f.has(S)){f.delete(S);return}i.forEach(j=>{j!==S&&(f.add(j),d(()=>{j.scrollLeft=S.scrollLeft}))})};return i.forEach(y=>{y.addEventListener("scroll",p)}),()=>{i.forEach(y=>{y.removeEventListener("scroll",p)})}},[]);const[F,L]=a.useState(()=>new Map),{hasFixedLeft:M,hasFixedRight:T}=O({bodyScrollContainer:C,columns:o}),N=P({columns:o,columnSizes:F});return m.jsxs("div",{ref:r,className:H("virtual-table",M&&"virtual-table-has-fix-left",T&&"virtual-table-has-fix-right"),children:[m.jsx("div",{ref:b,className:"virtual-table-header-wrapper",children:m.jsxs("table",{className:"virtual-table-header-root",children:[m.jsx(I,{columns:o}),m.jsx("thead",{className:"virtual-table-header",children:m.jsx("tr",{children:o.map((w,R)=>{const i=k(w),{className:d,style:f}=N(w);return m.jsx("th",{className:H("virtual-table-header-cell",d),style:f,children:w.title},typeof i=="symbol"?R:i)})})})]})}),m.jsx("div",{ref:C,className:"virtual-table-body-wrapper",children:m.jsxs("table",{className:"virtual-table-body-root",style:{paddingBottom:l,paddingTop:s},children:[m.jsx(I,{columns:o,onColumnSizesMeasure:w=>{L(w)}}),m.jsx("tbody",{className:"virtual-table-body",children:g==null?void 0:g.map((w,R)=>{const i=u+R,d=w,f=d[n];return m.jsx("tr",{ref:p=>{p!=null&&x(i,p.offsetHeight)},children:o.map((p,y)=>{const S=k(p),{className:j,style:h}=N(p);return m.jsx("td",{className:H("virtual-table-cell",j),style:h,children:J(i,d,p)},typeof S=="symbol"?y:S)})},f)})})]})})]})}const te=()=>{const[e,n]=a.useState(100),[t,o]=a.useState(100),[c,r]=a.useState(()=>D(e)),[E,g]=a.useState(()=>z(t,[0],[t-1]));return m.jsxs(m.Fragment,{children:[m.jsx(K,{dataCount:e,onDataCountChange:s=>{n(s),r(D(s))},columnCount:t,onColumnCountChange:s=>{o(s),g(z(s,[0],[s-1]))}}),m.jsx(U,{rowKey:"key",columns:E,dataSource:c,estimatedRowHeight:40})]})};export{te as default};
