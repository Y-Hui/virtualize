import{r as u,j as m}from"./index-CY4ZcjyI.js";import{m as D,a as z,A as K}from"./mock-lxX89zHs.js";import{c as H}from"./clsx-B-dksMZM.js";function j(e){return"key"in e?e.key:e.dataIndex}function I(e){const{columns:n,onColumnSizesMeasure:t}=e,r=t!=null,a=u.useRef(new Map);return m.jsx("colgroup",{ref:()=>{r&&t(a.current)},children:n.map((i,b)=>{const x=j(i);return m.jsx("col",{ref:o=>{o==null||!r||a.current.set(x,o.offsetWidth)},style:{width:i.width,minWidth:i.minWidth}},typeof x=="symbol"?b:x)})})}function O(e){const{columns:n,bodyScrollContainer:t}=e,[r,a]=u.useState(!1),[i,b]=u.useState(!1),x=n.some(l=>l.fixed==="left"),o=n.some(l=>l.fixed==="right");return u.useEffect(()=>{const l=t.current;if(l==null)return;const c=()=>{const{scrollLeft:y,clientWidth:v,scrollWidth:k}=l;x&&a(y!==0),o&&b(!(y+v>=k))};return c(),l.addEventListener("scroll",c),()=>{l.removeEventListener("scroll",c)}},[t,x,o]),{hasFixedLeft:r,hasFixedRight:i}}function P(e){const{columns:n,columnSizes:t}=e,r=u.useMemo(()=>{const o=new Map;return n.reduce((l,c)=>{if(c.fixed!=null&&["left","right"].includes(c.fixed)){const y=j(c),v=t.get(y)??0;if(c.fixed==="left")return o.set(y,l),l+v}return l},0),n.reduceRight((l,c)=>{if(c.fixed!=null&&["left","right"].includes(c.fixed)){const y=j(c),v=t.get(y)??0;if(c.fixed==="right")return o.set(y,l),l+v}return l},0),o},[t,n]),a=n.reduce((o,l)=>l.fixed==="left"?j(l):o,void 0),i=n.find(o=>o.fixed==="right"),b=i==null?void 0:j(i);return o=>{if(o.fixed!=null&&["left","right"].includes(o.fixed)){const l=j(o),c=o.fixed==="left",y=o.fixed==="right";return{className:H("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":c&&a===l,"virtual-table-cell-fix-right-first":y&&b===l}),style:{left:c?r.get(l):void 0,right:y?r.get(l):void 0}}}return{className:""}}}const Y=/auto|scroll|overlay|hidden/;function A(e){return e instanceof Node?e.nodeType===1:!1}function _(e,n=window){let t=e;for(;t!==n&&A(t);){if(t===document.body)return n;const{overflow:r,overflowY:a,overflowX:i}=window.getComputedStyle(t);if(Y.test(r+a+i))return t;t=t.parentNode}return e.ownerDocument.defaultView??window}function W(e){return Object.prototype.toString.call(e)==="[object Window]"}function V(e){return Object.prototype.toString.call(e)==="[object HTMLDocument]"}function q(e){return Object.prototype.toString.call(e)==="[object HTMLHtmlElement]"}function Q(e){return V(e)?e.scrollingElement:A(e)?e:document.scrollingElement}function X(e,n){let t=0,r=e.length-1,a=-1;for(;t<=r;){const i=Math.floor((t+r)/2);e[i].bottom>n?(a=i,r=i-1):t=i+1}if(a!==-1)return e[a]}function G(e){const{dataSource:n,estimateSize:t,getScrollContainer:r,overscan:a=0}=e,[i,b]=u.useState(0),[x,o]=u.useState(0),l=u.useMemo(()=>{if(n!=null)return n.slice(i,x)},[n,x,i]),c=u.useRef([]);(()=>{const s=(n==null?void 0:n.length)??0;for(let d=0;d<s;d++)c.current[d]==null&&(c.current[d]=t);c.current=c.current.slice(0,s)})();const v=u.useRef([]),k=(s=!1)=>{if(s&&v.current.length>0)return;const{rects:d}=c.current.reduce((f,g,w)=>{const S=f.top+g;return f.rects.push({index:w,top:f.top,height:g,bottom:S}),f.top=S,f},{top:0,rects:[]});v.current=d},T=u.useCallback((s,d)=>{const f=c.current[s];c.current[s]=d,k(f===d)},[]),N=u.useRef({index:0,height:t,top:0,bottom:t}),L=u.useRef(!1),M=u.useRef(0);u.useEffect(()=>{const s=r();if(s==null)return;let d=0;const f=h=>{d=Math.ceil(h/t)},g=()=>W(s)?{width:window.innerWidth,height:window.innerHeight}:{width:s.offsetWidth,height:s.offsetHeight},w=()=>{let h=0;return W(s)||q(s)?h=window.scrollY:h=Q(s).scrollTop,Math.max(h,0)};if(f(g().height),!L.current){L.current=!0;const h=w();let E=0;h>=t&&(E=Math.max(Math.floor(h/t)-1-a,0));const B=E+d+a;b(E),o(B)}const S=h=>{const E=X(v.current,h);E!=null&&(N.current=E,b(Math.max(0,E.index-a)),o(E.index+d+a))},R=()=>{const h=w();h>M.current?h>N.current.bottom&&S(h):h<N.current.top&&S(h),M.current=h};return s.addEventListener("scroll",R),()=>{s.removeEventListener("scroll",R)}},[t,r,a]);const F=(s,d)=>c.current.slice(s,d).reduce((f,g)=>f+g,0),p=F(0,i),C=F(x);return{dataSource:l,startIndex:i,topBlank:p,bottomBlank:C,updateRowHeight:T}}function J(e,n,t){const{render:r}=t,a=n;if("dataIndex"in t){const i=t.dataIndex;return typeof r!="function"?String(a[i]):r(a[i],n,e)}return(r==null?void 0:r(n,n,e))??null}function U(e){const{rowKey:n,dataSource:t,columns:r,estimatedRowHeight:a=40}=e,i=u.useRef(null),b=u.useCallback(()=>{const p=i.current;if(p!=null)return _(p)},[]),{dataSource:x,topBlank:o,bottomBlank:l,startIndex:c,updateRowHeight:y}=G({dataSource:t,estimateSize:a,overscan:5,getScrollContainer:b}),v=u.useRef(null),k=u.useRef(null);u.useEffect(()=>{const p=v.current,C=k.current;if(p==null||C==null)return;const s=[p,C],d=w=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{w()}):w()},f=new Set,g=w=>{const S=w.target;if(f.has(S)){f.delete(S);return}s.forEach(R=>{R!==S&&(f.add(R),d(()=>{R.scrollLeft=S.scrollLeft}))})};return s.forEach(w=>{w.addEventListener("scroll",g)}),()=>{s.forEach(w=>{w.removeEventListener("scroll",g)})}},[]);const[T,N]=u.useState(()=>new Map),{hasFixedLeft:L,hasFixedRight:M}=O({bodyScrollContainer:k,columns:r}),F=P({columns:r,columnSizes:T});return m.jsxs("div",{ref:i,className:H("virtual-table",L&&"virtual-table-has-fix-left",M&&"virtual-table-has-fix-right"),children:[m.jsx("div",{ref:v,className:"virtual-table-header-wrapper",children:m.jsxs("table",{className:"virtual-table-header-root",children:[m.jsx(I,{columns:r}),m.jsx("thead",{className:"virtual-table-header",children:m.jsx("tr",{children:r.map((p,C)=>{const s=j(p),{className:d,style:f}=F(p);return m.jsx("th",{className:H("virtual-table-header-cell",d),style:f,children:p.title},typeof s=="symbol"?C:s)})})})]})}),m.jsx("div",{ref:k,className:"virtual-table-body-wrapper",children:m.jsxs("table",{className:"virtual-table-body-root",style:{paddingBottom:l,paddingTop:o},children:[m.jsx(I,{columns:r,onColumnSizesMeasure:p=>{N(p)}}),m.jsx("tbody",{className:"virtual-table-body",children:x==null?void 0:x.map((p,C)=>{const s=c+C,d=p,f=d[n];return m.jsx("tr",{ref:g=>{g!=null&&y(s,g.offsetHeight)},children:r.map((g,w)=>{const S=j(g),{className:R,style:h}=F(g);return m.jsx("td",{className:H("virtual-table-cell",R),style:h,children:J(s,d,g)},typeof S=="symbol"?w:S)})},f)})})]})})]})}const te=()=>{const[e,n]=u.useState(1e3),[t,r]=u.useState(10),[a,i]=u.useState(()=>D(e)),[b,x]=u.useState(()=>z(t,[0],[t-1]));return m.jsxs(m.Fragment,{children:[m.jsx(K,{dataCount:e,onDataCountChange:o=>{n(o),i(D(o))},columnCount:t,onColumnCountChange:o=>{r(o),x(z(o,[0],[o-1]))}}),m.jsx(U,{rowKey:"key",columns:b,dataSource:a,estimatedRowHeight:40})]})};export{te as default};
