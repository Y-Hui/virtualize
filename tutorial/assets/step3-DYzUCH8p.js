import{r as d,j as a}from"./index-8XjBFZMU.js";import{m as F,a as k,A as N}from"./mock-BZlF3D7X.js";import{c as j}from"./clsx-B-dksMZM.js";function g(o){return"key"in o?o.key:o.dataIndex}function w(o){const{columns:i,onColumnSizesMeasure:s}=o,n=s!=null,u=d.useRef(new Map);return a.jsx("colgroup",{ref:()=>{n&&s(u.current)},children:i.map(c=>{const x=g(c);return a.jsx("col",{ref:m=>{m==null||!n||u.current.set(x,m.offsetWidth)},style:{width:c.width,minWidth:c.minWidth}},x)})})}function E(o){const{columns:i,bodyScrollContainer:s}=o,[n,u]=d.useState(!1),[c,x]=d.useState(!1),m=i.some(t=>t.fixed==="left"),e=i.some(t=>t.fixed==="right");return d.useEffect(()=>{const t=s.current;if(t==null)return;const l=()=>{const{scrollLeft:r,clientWidth:f,scrollWidth:y}=t;m&&u(r!==0),e&&x(!(r+f>=y))};return l(),t.addEventListener("scroll",l),()=>{t.removeEventListener("scroll",l)}},[s,m,e]),{hasFixedLeft:n,hasFixedRight:c}}function L(o){const{columns:i,columnSizes:s}=o,n=d.useMemo(()=>{const e=new Map;return i.reduce((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const r=g(l),f=s.get(r)??0;if(l.fixed==="left")return e.set(r,t),t+f}return t},0),i.reduceRight((t,l)=>{if(l.fixed!=null&&["left","right"].includes(l.fixed)){const r=g(l),f=s.get(r)??0;if(l.fixed==="right")return e.set(r,t),t+f}return t},0),e},[s,i]),u=i.reduce((e,t)=>t.fixed==="left"?g(t):e,void 0),c=i.find(e=>e.fixed==="right"),x=c==null?void 0:g(c);return e=>{if(e.fixed!=null&&["left","right"].includes(e.fixed)){const t=g(e),l=e.fixed==="left",r=e.fixed==="right";return{className:j("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":l&&u===t,"virtual-table-cell-fix-right-first":r&&x===t}),style:{left:l?n.get(t):void 0,right:r?n.get(t):void 0}}}return{className:""}}}function R(o,i,s){const{render:n}=s,u=i;if("dataIndex"in s){const c=s.dataIndex;return typeof n!="function"?String(u[c]):n(u[c],i,o)}return(n==null?void 0:n(i,i,o))??null}function z(o){const{rowKey:i,dataSource:s,columns:n}=o,u=d.useRef(null),c=d.useRef(null);d.useEffect(()=>{const r=u.current,f=c.current;if(r==null||f==null)return;const y=[r,f],S=h=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{h()}):h()},b=new Set,C=h=>{const p=h.target;if(b.has(p)){b.delete(p);return}y.forEach(v=>{v!==p&&(b.add(v),S(()=>{v.scrollLeft=p.scrollLeft}))})};return y.forEach(h=>{h.addEventListener("scroll",C)}),()=>{y.forEach(h=>{h.removeEventListener("scroll",C)})}},[]);const[x,m]=d.useState(()=>new Map),{hasFixedLeft:e,hasFixedRight:t}=E({bodyScrollContainer:c,columns:n}),l=L({columns:n,columnSizes:x});return a.jsxs("div",{className:j("virtual-table",e&&"virtual-table-has-fix-left",t&&"virtual-table-has-fix-right"),children:[a.jsx("div",{ref:u,className:"virtual-table-header-wrapper",children:a.jsxs("table",{className:"virtual-table-header-root",children:[a.jsx(w,{columns:n}),a.jsx("thead",{className:"virtual-table-header",children:a.jsx("tr",{children:n.map(r=>{const f=g(r),{className:y,style:S}=l(r);return a.jsx("th",{className:j("virtual-table-header-cell",y),style:S,children:r.title},f)})})})]})}),a.jsx("div",{ref:c,className:"virtual-table-body-wrapper",children:a.jsxs("table",{className:"virtual-table-body-root",children:[a.jsx(w,{columns:n,onColumnSizesMeasure:r=>{m(r)}}),a.jsx("tbody",{className:"virtual-table-body",children:s==null?void 0:s.map((r,f)=>{const y=r,S=y[i];return a.jsx("tr",{children:n.map((b,C)=>{const h=g(b),{className:p,style:v}=l(b);return a.jsx("td",{className:j("virtual-table-cell",p),style:v,children:R(f,y,b)},typeof h=="symbol"?C:h)})},S)})})]})})]})}const D=()=>{const[o,i]=d.useState(100),[s,n]=d.useState(100),[u,c]=d.useState(()=>F(o)),[x,m]=d.useState(()=>k(s,[0,1],[s-1,s-2]));return a.jsxs(a.Fragment,{children:[a.jsx(N,{dataCount:o,onDataCountChange:e=>{i(e),c(F(e))},columnCount:s,onColumnCountChange:e=>{n(e),m(k(e,[0,1],[e-1,e-2]))}}),a.jsx(z,{rowKey:"key",columns:x,dataSource:u})]})};export{D as default};
