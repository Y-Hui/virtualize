var ke=Object.defineProperty;var Ee=(n,t,e)=>t in n?ke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Z=(n,t,e)=>Ee(n,typeof t!="symbol"?t+"":t,e);import{r as u,j as p}from"./index-CY4ZcjyI.js";import{m as se,a as ce,A as He}from"./mock-lxX89zHs.js";import{c as $}from"./clsx-B-dksMZM.js";function le(n){const{columns:t,onColumnSizesMeasure:e}=n,o=e!=null,l=u.useRef(new Map);return p.jsx("colgroup",{ref:()=>{o&&e(l.current)},children:t.map(c=>{const{key:x}=c;if(c.type==="blank")return p.jsx("col",{style:{width:c.width}},x);const{column:h}=c;return p.jsx("col",{ref:r=>{r==null||!o||l.current.set(x,r.offsetWidth)},style:{width:h.width,minWidth:h.minWidth}},x)})})}function L(n,t,e){return typeof t=="function"?t(n,e):n}const G=class G{constructor(t){Z(this,"hooks",[]);this.use=this.use.bind(this),this.setHooks(t)}setHooks(t){this.hooks=t}use(t){if(this.hooks.length===0)return t;const e={current:t},o={render:[],renderContent:[],renderHeaderWrapper:[],renderHeaderRoot:[],renderHeader:[],renderHeaderRow:[],renderHeaderCell:[],renderBodyWrapper:[],renderBodyRoot:[],renderBody:[],renderRow:[],renderCell:[]},l=[],c=[];return this.hooks.slice().forEach(h=>{const r=h(e.current),{render:s,renderContent:i,renderHeaderWrapper:y,renderHeaderRoot:R,renderHeader:B,renderHeaderRow:_,renderHeaderCell:z,renderBodyWrapper:N,renderBodyRoot:M,renderBody:K,renderRow:Y,renderCell:A,rowClassName:m,onRow:g,...w}=r;Object.entries(o).forEach(([W,k])=>{const E=r[W];typeof E=="function"&&k.push(E)}),typeof m=="function"&&l.push(m),typeof g=="function"&&c.push(g),e.current=w}),Object.entries(o).forEach(([h,r])=>{r.length>0&&(e.current[h]=(s,i)=>r.reduce((y,R)=>R(y,i),s))}),l.length>0&&(e.current.rowClassName=(h,r)=>$(...l.map(s=>s(h,r)))),c.length>0&&(e.current.onRow=(h,r)=>c.reduce((s,i)=>({...s,...i(h,r)}),{})),e.current}};Z(G,"defaultInstance",new G([]));let ee=G;function ve(n){const{columns:t,bodyScrollContainer:e}=n,[o,l]=u.useState(!1),[c,x]=u.useState(!1),h=t.some(s=>s.fixed==="left"),r=t.some(s=>s.fixed==="right");return u.useEffect(()=>{const s=e.current;if(s==null)return;const i=()=>{const{scrollLeft:y,clientWidth:R,scrollWidth:B}=s;h&&l(y!==0),r&&x(!(y+R>=B))};return i(),s.addEventListener("scroll",i),()=>{s.removeEventListener("scroll",i)}},[e,h,r]),{hasFixedLeft:o,hasFixedRight:c}}function I(n){return"key"in n?n.key:n.dataIndex}function We(n){const{columns:t,columnSizes:e}=n,o=u.useMemo(()=>{const r=new Map;return t.reduce((s,i)=>{if(i.fixed!=null&&["left","right"].includes(i.fixed)){const y=I(i),R=e.get(y)??0;if(i.fixed==="left")return r.set(y,s),s+R}return s},0),t.reduceRight((s,i)=>{if(i.fixed!=null&&["left","right"].includes(i.fixed)){const y=I(i),R=e.get(y)??0;if(i.fixed==="right")return r.set(y,s),s+R}return s},0),r},[e,t]),l=t.reduce((r,s)=>s.fixed==="left"?I(s):r,void 0),c=t.find(r=>r.fixed==="right"),x=c==null?void 0:I(c);return r=>{if(r.fixed!=null&&["left","right"].includes(r.fixed)){const s=I(r),i=r.fixed==="left",y=r.fixed==="right";return{className:$("virtual-table-sticky-cell",{"virtual-table-cell-fix-left-last":i&&l===s,"virtual-table-cell-fix-right-first":y&&x===s}),style:{left:i?o.get(s):void 0,right:y?o.get(s):void 0}}}return{className:""}}}const Fe=/auto|scroll|overlay|hidden/;function ue(n){return n instanceof Node?n.nodeType===1:!1}function je(n,t=window){let e=n;for(;e!==t&&ue(e);){if(e===document.body)return t;const{overflow:o,overflowY:l,overflowX:c}=window.getComputedStyle(e);if(Fe.test(o+l+c))return e;e=e.parentNode}return n.ownerDocument.defaultView??window}function te(n){return Object.prototype.toString.call(n)==="[object Window]"}function Le(n){return Object.prototype.toString.call(n)==="[object HTMLDocument]"}function Ne(n){return Object.prototype.toString.call(n)==="[object HTMLHtmlElement]"}function Me(n){return Le(n)?n.scrollingElement:ue(n)?n:document.scrollingElement}function De(n,t){let e=0,o=n.length-1,l=-1;for(;e<=o;){const c=Math.floor((e+o)/2);n[c].right>t?(l=c,o=c-1):e=c+1}if(l!==-1)return n[l]}function Ie(n){let t=-1;for(let e=n.length-1;e>=0&&n[e].fixed==="right";e--)t=e;return t}function Be(n){let t=-1;for(let e=0;e<n.length;e+=1)n[e].fixed==="left"&&(t=e);return t}function ie(n){const t=u.useRef(null);return u.useLayoutEffect(()=>{t.current=n},[n]),u.useCallback((...o)=>{var l;return(l=t.current)==null?void 0:l.call(t,...o)},[])}function _e(n){const{estimateSize:t,overscan:e,columns:o,bodyWrapper:l,columnWidths:c,disabled:x}=n,h=u.useMemo(()=>{if(x)return[];let f=0;return o.map((d,a)=>{const C=I(d),q=c.get(C)??t,O=f+q,F={index:a,width:q,left:f,right:O};return f=O,F})},[o,c,t,x]),r=Be(o),s=Ie(o),i=r>-1?I(o[r]):null,y=s>-1?I(o[s]):null,[R,B]=u.useState(0),[_,z]=u.useState(0),N=u.useMemo(()=>{if(x)return o;const f=[...o.slice(0,r+1),...o.slice(R,_),...o.slice(s)],d=new Set;return f.filter(a=>{const C=I(a);return d.has(C)?!1:(d.add(C),!0)})},[x,o,R,_,r,s]),M=(f,d)=>h.slice(f,d).reduce((a,C)=>a+C.width,0),K=r>-1?M(0,r+1):0,Y=s>-1?M(s):0,A=Math.max(0,M(0,R)-K),m=Math.max(0,M(_)-Y),g=u.useMemo(()=>N.reduce((f,d)=>{const a=I(d);return a===i?(f.push({key:a,type:"normal",column:d}),f.push({key:"_blank_left",type:"blank",width:A})):a===y?(f.push({key:"_blank_right",type:"blank",width:m}),f.push({key:a,type:"normal",column:d})):f.push({key:a,type:"normal",column:d}),f},[]),[N,i,y,A,m]),w=u.useRef({index:0,width:t,left:0,right:t}),W=ie(f=>De(h,f)),k=ie((f,d)=>{const a=W(f);a!=null&&(w.current=a,B(Math.max(0,a.index-e)),z(a.index+d+e))}),E=u.useRef(0);return u.useEffect(()=>{if(x)return;const f=l.current;if(f==null)return;const d=f.offsetWidth;let a=Math.ceil(d/t);const C=F=>{a=Math.ceil(F/t)},q=()=>te(f)?{width:window.innerWidth,height:window.innerHeight}:{width:f.offsetWidth,height:f.offsetHeight},O=()=>{const F=f.scrollLeft;F>E.current?F>w.current.right&&k(F,a):F<w.current.left&&k(F,a),E.current=F};return f.addEventListener("scroll",O),C(q().width),k(f.scrollLeft,a),()=>{f.removeEventListener("scroll",O)}},[l,t,e,x,k]),{columns:N,descriptor:g}}function ze(n,t){let e=0,o=n.length-1,l=-1;for(;e<=o;){const c=Math.floor((e+o)/2);n[c].bottom>t?(l=c,o=c-1):e=c+1}if(l!==-1)return n[l]}function Te(n){const{dataSource:t,estimateSize:e,getScrollContainer:o,overscan:l=0}=n,[c,x]=u.useState(0),[h,r]=u.useState(0),s=u.useMemo(()=>{if(t!=null)return t.slice(c,h)},[t,h,c]),i=u.useRef([]);(()=>{const m=(t==null?void 0:t.length)??0;for(let g=0;g<m;g++)i.current[g]==null&&(i.current[g]=e);i.current=i.current.slice(0,m)})();const R=u.useRef([]),B=(m=!1)=>{if(m&&R.current.length>0)return;const{rects:g}=i.current.reduce((w,W,k)=>{const E=w.top+W;return w.rects.push({index:k,top:w.top,height:W,bottom:E}),w.top=E,w},{top:0,rects:[]});R.current=g},_=u.useCallback((m,g)=>{const w=i.current[m];i.current[m]=g,B(w===g)},[]),z=u.useRef({index:0,height:e,top:0,bottom:e}),N=u.useRef(!1),M=u.useRef(0);u.useEffect(()=>{const m=o();if(m==null)return;let g=0;const w=d=>{g=Math.ceil(d/e)},W=()=>te(m)?{width:window.innerWidth,height:window.innerHeight}:{width:m.offsetWidth,height:m.offsetHeight},k=()=>{let d=0;return te(m)||Ne(m)?d=window.scrollY:d=Me(m).scrollTop,Math.max(d,0)};if(w(W().height),!N.current){N.current=!0;const d=k();let a=0;d>=e&&(a=Math.max(Math.floor(d/e)-1-l,0));const C=a+g+l;x(a),r(C)}const E=d=>{const a=ze(R.current,d);a!=null&&(z.current=a,x(Math.max(0,a.index-l)),r(a.index+g+l))},f=()=>{const d=k();d>M.current?d>z.current.bottom&&E(d):d<z.current.top&&E(d),M.current=d};return m.addEventListener("scroll",f),()=>{m.removeEventListener("scroll",f)}},[e,o,l]);const K=(m,g)=>i.current.slice(m,g).reduce((w,W)=>w+W,0),Y=K(0,c),A=K(h);return{dataSource:s,startIndex:c,topBlank:Y,bottomBlank:A,updateRowHeight:_}}function Ke(n,t,e){const{render:o}=e,l=t;if("dataIndex"in e){const c=e.dataIndex;return typeof o!="function"?String(l[c]):o(l[c],t,n)}return(o==null?void 0:o(t,t,n))??null}function Ae(n){const{rowKey:t,dataSource:e,columns:o,estimatedRowHeight:l=40,estimatedColumnWidth:c,pipeline:x=ee.defaultInstance}=n,h=u.useRef(null),r=u.useCallback(()=>{const S=h.current;if(S!=null)return je(S)},[]),s=u.useRef(null),i=u.useRef(null),y=u.useRef(null),R=u.useRef(null),{dataSource:B,columns:_,rowKey:z,rowClassName:N,render:M,renderContent:K,renderHeaderWrapper:Y,renderHeaderRoot:A,renderHeader:m,renderHeaderRow:g,renderHeaderCell:w,renderBodyWrapper:W,renderBodyRoot:k,renderBody:E,renderRow:f,renderCell:d,onRow:a}=x.use({dataSource:e??[],columns:o,rowKey:t,estimatedRowHeight:l,rootRef:h,headerWrapperRef:s,bodyWrapperRef:i,bodyRootRef:y,bodyRef:R,getScroller:r}),{dataSource:C,topBlank:q,bottomBlank:O,startIndex:F,updateRowHeight:ne}=Te({dataSource:B,estimateSize:l,overscan:5,getScrollContainer:r});u.useEffect(()=>{const S=s.current,P=i.current;if(S==null||P==null)return;const v=[S,P],T=j=>{typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(()=>{j()}):j()},V=new Set,Q=j=>{const X=j.target;if(V.has(X)){V.delete(X);return}v.forEach(D=>{D!==X&&(V.add(D),T(()=>{D.scrollLeft=X.scrollLeft}))})};return v.forEach(j=>{j.addEventListener("scroll",Q)}),()=>{v.forEach(j=>{j.removeEventListener("scroll",Q)})}},[]);const[J,ae]=u.useState(()=>new Map),{columns:H,descriptor:b}=_e({estimateSize:c??100,overscan:3,columns:_,bodyWrapper:i,columnWidths:J,disabled:c==null}),{hasFixedLeft:de,hasFixedRight:fe}=ve({bodyScrollContainer:i,columns:H}),re=We({columns:H,columnSizes:J}),he=L(p.jsx("tr",{children:b.map((S,P)=>{const{key:v}=S;if(S.type==="blank")return p.jsx("th",{},v);const{column:T}=S,{className:V,style:Q}=re(T),j=p.jsx("th",{className:$("virtual-table-header-cell",V),style:Q,children:T.title},typeof v=="symbol"?P:v);return L(j,w,{columns:H,columnDescriptor:b,column:T,columnIndex:0,columnWidths:J})})}),g,{columns:H,columnDescriptor:b}),me=L(p.jsx("thead",{className:"virtual-table-header",children:he}),m,{columns:H,columnDescriptor:b}),pe=L(p.jsxs("table",{className:"virtual-table-header-root",children:[p.jsx(le,{columns:b}),me]}),A,{columns:H,columnDescriptor:b}),xe=L(p.jsx("div",{ref:s,className:"virtual-table-header-wrapper",children:pe}),Y,{columns:H,columnDescriptor:b}),ge=L(p.jsx("tbody",{ref:R,className:"virtual-table-body",children:C==null?void 0:C.map((S,P)=>{const v=F+P,T=S,V=T[z],{className:Q,...j}=(a==null?void 0:a(S,v))??{},X=u.createElement("tr",{...j,key:V,ref:D=>{D!=null&&ne(v,D.offsetHeight)},className:$(Q,N==null?void 0:N(S,v))},b.map(D=>{const{key:oe}=D;if(D.type==="blank")return p.jsx("td",{},oe);const{column:U}=D,{className:Se,style:be}=re(U),Ce=p.jsx("td",{className:$("virtual-table-cell",Se),style:be,children:Ke(v,T,U)},oe);return L(Ce,d,{column:U,columnIndex:0})}));return L(X,f,{columns:H,columnDescriptor:b,rowIndex:v,rowData:S})})}),E,{columns:H,columnDescriptor:b}),ye=L(p.jsxs("table",{ref:y,className:"virtual-table-body-root",style:{paddingBottom:O,paddingTop:q},children:[p.jsx(le,{columns:b,onColumnSizesMeasure:S=>{ae(S)}}),ge]}),k,{columns:H,columnDescriptor:b}),we=L(p.jsx("div",{ref:i,className:"virtual-table-body-wrapper",children:ye}),W,{columns:H,columnDescriptor:b}),Re=L(p.jsxs(p.Fragment,{children:[xe,we]}),K,{columns:H,columnDescriptor:b});return L(p.jsx("div",{ref:h,className:$("virtual-table",de&&"virtual-table-has-fix-left",fe&&"virtual-table-has-fix-right"),children:Re}),M,{columns:H,columnDescriptor:b})}const Pe=()=>{const[n,t]=u.useState(1e3),[e,o]=u.useState(1e3),[l,c]=u.useState(()=>se(n)),[x,h]=u.useState(()=>ce(e,[0],[e-1]));return p.jsxs(p.Fragment,{children:[p.jsx(He,{dataCount:n,onDataCountChange:r=>{t(r),c(se(r))},columnCount:e,onColumnCountChange:r=>{o(r),h(ce(r,[0],[r-1]))}}),p.jsx(Ae,{rowKey:"key",columns:x,dataSource:l,estimatedRowHeight:40,estimatedColumnWidth:180})]})};export{Pe as default};
