var Ce=Object.defineProperty;var be=(e,n,r)=>n in e?Ce(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var te=(e,n,r)=>be(e,typeof n!="symbol"?n+"":n,r);import{r as u,j as w,c as M,i as ve}from"./index-CF_IaDcW.js";import{e as Ee,C as ae,F as K,D as Re,f as Se}from"./mock-DBoiK4Ma.js";const X=class X{constructor(){te(this,"hooks",[])}use(n){const r={current:n},t={render:[],renderBody:[],renderRow:[],renderCell:[],renderHeader:[],renderHeaderCell:[]};return this.hooks.forEach(s=>{const{render:l,renderBody:f,renderRow:h,renderCell:g,renderHeader:d,renderHeaderCell:o,...c}=s(r.current);typeof l=="function"&&t.render.push(l),typeof f=="function"&&t.renderBody.push(f),typeof h=="function"&&t.renderRow.push(h),typeof g=="function"&&t.renderCell.push(g),typeof d=="function"&&t.renderHeader.push(d),typeof o=="function"&&t.renderHeaderCell.push(o),r.current=c}),Object.entries(t).forEach(([s,l])=>{l.length>0&&(r.current[s]=(f,h)=>l.reduce((g,d)=>d(g,h),f))}),r.current}};te(X,"defaultPipeline",new X);let Q=X;function Ne(e){var t;const{use:n}=e,r=u.useMemo(()=>new Q,[]);return n!=null&&(r.hooks=n.filter(s=>s!=null).concat(((t=e.pipeline)==null?void 0:t.hooks)??[])),r}const ke=["scroll","auto","overlay"];function ue(e){return e instanceof Node?e.nodeType===1:!1}function ne(e,n=window){let r=e;for(;r&&r!==n&&ue(r);){if(r===document.body)return n;const{overflowY:t}=window.getComputedStyle(r);if(ke.includes(t))return r;r=r.parentNode}return e.ownerDocument.defaultView||window}function Le(e){return Object.prototype.toString.call(e)==="[object Window]"}function Te(e){return Object.prototype.toString.call(e)==="[object HTMLDocument]"}function Ie(e){return Object.prototype.toString.call(e)==="[object HTMLHtmlElement]"}function re(e){return Te(e)?e.scrollingElement:ue(e)?e:document.scrollingElement}const je=(e,n)=>{typeof e=="function"?e(n):typeof e=="object"&&e&&"current"in e&&(e.current=n)},Oe=(...e)=>{const n=e.filter(Boolean);return n.length<=1?n[0]:r=>{e.forEach(t=>{je(t,r)})}};function fe(e,n){let r=-1;for(let t=0;t<e.length;t+=1)n(e[t],t)&&(r=t);return r}function ie(e,n){if(e===n)return!0;if(!e||!n)return!1;const r=Object.keys(e),t=Object.keys(n),s=r.length;if(t.length!==s)return!1;for(let l=0;l<s;l+=1){const f=r[l];if(e[f]!==n[f]||!Object.prototype.hasOwnProperty.call(n,f))return!1}return!0}function se(e,n){if(e===n)return!0;if(!e||!n)return!1;const r=e.length;if(n.length!==r)return!1;for(let t=0;t<r;t+=1)if(e[t]!==n[t])return!1;return!0}function He(e,n){return Object.is(e,n)?!0:Array.isArray(e)&&Array.isArray(n)?se(e,n)?!0:e.length===n.length&&e.findIndex(t=>typeof t=="object"&&t!=null)>-1?e.every((t,s)=>Array.isArray(t)?se(t,n[s]):typeof t=="object"&&t!=null?ie(t,n[s]):Object.is(t,n[s])):!1:typeof e=="object"&&e!=null?ie(e,n):!1}function de(e){const n=e(),r=u.useRef(n);return He(n,r.current)||(r.current=n),r.current}const he=u.createContext(null);function Pe(e){const{columns:n,children:r}=e,[t,s]=u.useState([]),l=u.useRef([]),f=o=>{const c=o.slice();se(l.current,c)||(l.current=c,s(c))},h=de(()=>n.map(o=>o.fixed)),g=u.useMemo(()=>{let o=0;const c=h.reduce((p,i,y)=>(i==="left"&&(p[y]=o,o+=t[y]??0),p),[]);let m=0;const a=h.reduceRight((p,i,y)=>(i==="right"&&(p[y]=m,m+=t[y]??0),p),[]);return h.map((p,i)=>p==="left"?c[i]:p==="right"?a[i]:0)},[t,h]),d=u.useMemo(()=>({widthList:t,setWidthList:f,stickySizes:g}),[t,g]);return w.jsx(he.Provider,{value:d,children:r})}function ye(){const e=u.useContext(he);if(e==null)throw Error("useTableColumns 脱离上下文调用");return e}function Y(e,n,r){return typeof n=="function"?n(e,r):e}function Fe(e,n,r){const{render:t}=r,s=n;if("dataIndex"in r){const l=r.dataIndex;return typeof t!="function"?s[l]:t(l==null?n:s[l],n,e)}return(t==null?void 0:t(n,n,e))??null}function _e(e){const{className:n,style:r,children:t,column:s,rowData:l,rowIndex:f,columnIndex:h,cellPipelineRender:g,...d}=e,{align:o,fixed:c,onCell:m}=s,{stickySizes:a}=ye(),{className:p,style:i,colSpan:y,rowSpan:x,...L}=(m==null?void 0:m(l,f))||{};return y===0||x===0?null:Y(w.jsx("td",{...d,...L,colSpan:y,rowSpan:x,className:M("virtual-table-cell",o!=null&&`virtual-table-align-${o}`,typeof c=="string"&&"virtual-table-sticky-cell",n,s.className,p),style:{...r,...i,left:c==="left"?a[h]:void 0,right:c==="right"?a[h]:void 0},children:Fe(f,l,s)}),g,{column:s,columnIndex:h})}const Ae=u.memo(_e),pe=u.createContext(null);function Ke(){const e=u.useContext(pe);if(e==null)throw Error("useTableShared 脱离上下文调用");return e}function Me(e){const{className:n,children:r,rowIndex:t,rowData:s,columns:l,onRow:f,rowPipelineRender:h,cellPipelineRender:g,...d}=e,{updateRowHeight:o}=Ke(),c=fe(l,i=>i.fixed==="left"),m=l.findIndex(i=>i.fixed==="right"),{className:a,...p}=(f==null?void 0:f(s,t))??{};return Y(w.jsx("tr",{...d,...p,className:M("virtual-table-row",n,a),ref:i=>{i!=null&&o(t,i.offsetHeight)},children:l.map((i,y)=>{const x="key"in i?i.key:i.dataIndex;return w.jsx(Ae,{className:M(c===y&&"virtual-table-cell-fix-left-last",m===y&&"virtual-table-cell-fix-right-last"),column:i,rowIndex:t,rowData:s,columnIndex:y,cellPipelineRender:g},typeof x=="symbol"?y:x)})}),h,{columns:l,rowIndex:t,rowData:s})}const De=u.memo(Me);function We(e){const{dataSource:n,columns:r,rowKey:t,startIndex:s,rowClassName:l,onRow:f,bodyRender:h,rowPipelineRender:g,cellPipelineRender:d}=e;return Y(w.jsx("tbody",{children:n==null?void 0:n.map((o,c)=>{const m=o[t];return w.jsx(De,{className:M(l==null?void 0:l(o,c)),rowIndex:c+s,rowData:o,columns:r,onRow:f,rowPipelineRender:g,cellPipelineRender:d},m)})}),h,{columns:r})}const Ve=e=>{const{className:n,style:r,columns:t,stickyHeader:s,headerRender:l,cellRender:f}=e,{widthList:h,setWidthList:g,stickySizes:d}=ye(),o=u.useRef([]);u.useLayoutEffect(()=>{g(o.current)});const c=fe(t,a=>a.fixed==="left"),m=t.findIndex(a=>a.fixed==="right");return w.jsxs("table",{className:M("virtual-table-header-wrapper",n,{"virtual-table-sticky-header":s!=null}),style:{...r,top:Number.isFinite(s)?s:void 0},children:[w.jsx("colgroup",{children:t.map((a,p)=>{const i="key"in a?a.key:a.dataIndex;return w.jsx("col",{style:{width:a.width,minWidth:a.minWidth},ref:y=>{y!=null&&(o.current[p]=y.offsetWidth)}},typeof i=="symbol"?p:i)})}),w.jsx("thead",{className:"virtual-table-header",children:Y(w.jsx("tr",{children:t.map((a,p)=>{var W;if(a.colSpan===0)return null;const i="key"in a?a.key:a.dataIndex,{className:y,style:x,...L}=((W=a.onHeaderCell)==null?void 0:W.call(a,a,p))||{};return w.jsx(u.Fragment,{children:Y(u.createElement("th",{scope:"col",...L,colSpan:a.colSpan,className:M("virtual-table-header-cell",a.align!=null&&`virtual-table-align-${a.align}`,typeof a.fixed=="string"&&"virtual-table-sticky-cell",c===p&&"virtual-table-cell-fix-left-last",m===p&&"virtual-table-cell-fix-right-last",a.className,y),style:{...x,left:a.fixed==="left"?d[p]:void 0,right:a.fixed==="right"?d[p]:void 0}},a.title),f||void 0,{column:a,columns:t,columnIndex:p,columnWidthList:h})},typeof i=="symbol"?p:i)})}),l,{columns:t})})]})};function $e(e){const{itemCount:n,estimatedRowHeight:r=46}=e,t=u.useRef([]);(()=>{for(let d=0;d<n;d+=1)t.current[d]==null&&(t.current[d]=r);t.current=t.current.slice(0,n)})();const l=u.useRef([]),f=()=>{const d=[];let o=0;t.current.forEach((c,m)=>{m!==0&&(o+=c),d.push({index:m,height:c,top:o,bottom:o+c})}),l.current=d},h=u.useCallback((d,o)=>{t.current[d]=o,f()},[]);return{rowHeightList:t,updateRowHeight:h,sum:(d,o)=>t.current.slice(d,o).reduce((c,m)=>c+m,0),rects:u.useCallback(()=>l.current,[])}}function me(e){var n,r,t="";if(typeof e=="string"||typeof e=="number")t+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(n=0;n<s;n++)e[n]&&(r=me(e[n]))&&(t&&(t+=" "),t+=r)}else for(r in e)e[r]&&(t&&(t+=" "),t+=r);return t}function ze(){for(var e,n,r=0,t="",s=arguments.length;r<s;r++)(e=arguments[r])&&(n=me(e))&&(t&&(t+=" "),t+=n);return t}const Ye=e=>{const{className:n,style:r,children:t,hasFixedLeftColumn:s,hasFixedRightColumn:l}=e,f=u.useRef(null),[h,g]=u.useState(!1),[d,o]=u.useState(!1);return u.useEffect(()=>{const c=f.current;if(c==null||!s&&!l)return;const m=ne(c),a=()=>{const p=re(m),{scrollLeft:i,clientWidth:y,scrollWidth:x}=p;s&&g(i!==0),l&&o(!(i+y>=x))};return a(),m.addEventListener("scroll",a),()=>{m.removeEventListener("scroll",a)}},[s,l]),w.jsx("div",{ref:f,className:ze("virtual-table",h&&"virtual-table-has-fix-left",d&&"virtual-table-has-fix-right",n),style:r,children:t})};function Ue(e,n){const{rootClassName:r,rootStyle:t,className:s,style:l,columns:f,dataSource:h,rowKey:g="key",estimatedRowHeight:d,overscanCount:o=5,stickyHeader:c,pipeline:m=Q.defaultPipeline,rowClassName:a,onRow:p,...i}=e,{dataSource:y,columns:x,rowKey:L,rowClassName:W,render:R,renderBody:F,renderRow:Z,renderCell:$,renderHeader:I,renderHeaderCell:q}=m.use({dataSource:h,rowKey:g,columns:f,rowClassName:a}),z=u.useRef(null),{rects:_,updateRowHeight:G,sum:v}=$e({itemCount:(y==null?void 0:y.length)??0,estimatedRowHeight:d}),S=u.useRef(0),[j,O]=u.useState(0),[A,U]=u.useState(0),ee=u.useMemo(()=>{var C;return(C=y??[])==null?void 0:C.slice(j,A)},[y,j,A]),J=y==null?!1:y.length>0;u.useLayoutEffect(()=>{const C=z.current;if(C==null)return;const H=ne(C);let N=0;Le(H)||Ie(H)?N=window.innerHeight:N=re(H).getBoundingClientRect().height;const k=Math.ceil(N/d);S.current===0&&(O(0),U(0+k+o)),S.current=k},[d,J,o]),u.useEffect(()=>{const C=z.current;if(C==null)return;const H=ne(C),N=k=>{const T=re(k.target),{scrollTop:P}=T,B=_().find(xe=>xe.bottom>P);B!=null&&(O(Math.max(0,B.index-o)),U(B.index+S.current+o))};return H.addEventListener("scroll",N),()=>{H.removeEventListener("scroll",N)}},[o,_]);const le=v(0,j),oe=v(A),b=x.some(C=>C.fixed==="left"),E=x.some(C=>C.fixed==="right"),D=u.useMemo(()=>({updateRowHeight:G}),[G]),V=w.jsxs(Ye,{className:r,style:t,hasFixedLeftColumn:b,hasFixedRightColumn:E,children:[w.jsx(Ve,{columns:x,stickyHeader:c,headerRender:I,cellRender:q}),w.jsxs("table",{...i,className:M(s,"virtual-table-body"),style:{...l,paddingBottom:oe,paddingTop:le},ref:Oe(z,n),children:[w.jsx("colgroup",{children:x.map((C,H)=>{const N="key"in C?C.key:C.dataIndex;return w.jsx("col",{style:{width:C.width,minWidth:C.minWidth}},typeof N=="symbol"?H:N)})}),w.jsx(We,{columns:x,rowKey:L,dataSource:ee,startIndex:j,rowClassName:W,onRow:p,bodyRender:F,rowPipelineRender:Z,cellPipelineRender:$})]})]});return w.jsx(pe.Provider,{value:D,children:w.jsx(Pe,{columns:x,children:Y(V,R,{columns:x})})})}const Be=u.forwardRef(Ue);function ge(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var t=r.call(e),s,l=[],f;try{for(;(n===void 0||n-- >0)&&!(s=t.next()).done;)l.push(s.value)}catch(h){f={error:h}}finally{try{s&&!s.done&&(r=t.return)&&r.call(t)}finally{if(f)throw f.error}}return l}function qe(e,n,r){if(r||arguments.length===2)for(var t=0,s=n.length,l;t<s;t++)(l||!(t in n))&&(l||(l=Array.prototype.slice.call(n,0,t)),l[t]=n[t]);return e.concat(l||Array.prototype.slice.call(n))}var Ge=function(e){return typeof e=="function"};function we(e){var n=u.useRef(e);n.current=u.useMemo(function(){return e},[e]);var r=u.useRef();return r.current||(r.current=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return n.current.apply(this,t)}),r.current}var Je=function(){var e=ge(u.useState({}),2),n=e[1];return u.useCallback(function(){return n({})},[])};function Qe(e,n){e===void 0&&(e={}),n===void 0&&(n={});var r=n.defaultValue,t=n.defaultValuePropName,s=t===void 0?"defaultValue":t,l=n.valuePropName,f=l===void 0?"value":l,h=n.trigger,g=h===void 0?"onChange":h,d=e[f],o=Object.prototype.hasOwnProperty.call(e,f),c=u.useMemo(function(){return o?d:Object.prototype.hasOwnProperty.call(e,s)?e[s]:r},[]),m=u.useRef(c);o&&(m.current=d);var a=Je();function p(i){for(var y=[],x=1;x<arguments.length;x++)y[x-1]=arguments[x];var L=Ge(i)?i(m.current):i;o||(m.current=L,a()),e[g]&&e[g].apply(e,qe([L],ge(y),!1))}return[m.current,we(p)]}function Xe(e){const{index:n,isRadio:r,record:t,checked:s=!1,renderCell:l,onCheckboxChange:f,onRadioChange:h,defaultChecked:g,...d}=e,o=u.createElement(r?Ee:ae,{...d,checked:s,onChange(c){return r?h==null?void 0:h(c):f==null?void 0:f(c)}});if(l){const c=l(s,t,n,o);return u.isValidElement(c)?c:null}return o}const ce=[K.SELECTION_ALL,K.SELECTION_INVERT,K.SELECTION_NONE];function Ze(e){const{checked:n,onChange:r,indeterminate:t,selections:s,onClear:l,onSelectAll:f,onSelectInvert:h,allKeys:g,disabled:d}=e,{locale:o}=u.useContext(ve.ConfigContext),c=o==null?void 0:o.Table,m={[K.SELECTION_ALL]:{key:K.SELECTION_ALL,label:c==null?void 0:c.selectAll,onClick:f},[K.SELECTION_INVERT]:{key:K.SELECTION_INVERT,label:c==null?void 0:c.selectInvert,onClick:h},[K.SELECTION_NONE]:{key:K.SELECTION_NONE,label:c==null?void 0:c.selectNone,onClick:l}},a=s===!0?ce:Array.isArray(s)?s:void 0;return w.jsxs("div",{className:M("virtual-table-selection"),children:[w.jsx(ae,{checked:n,indeterminate:t,disabled:d,onChange:r}),a&&w.jsx("div",{className:"virtual-table-selection-extra",children:w.jsx(Re,{menu:{items:a.reduce((p,i)=>(typeof i=="string"?ce.includes(i)&&p.push(m[i]):"key"in i&&p.push({key:i.key,label:i.text,onClick:()=>{var y;(y=i.onSelect)==null||y.call(i,g)}}),p),[])},children:w.jsx(Se,{})})})]})}const et="VirtualTable.SELECTION_COLUMN",tt=[];function nt(e){return function(r){const t=e==null,{columns:s}=r,l=r.rowKey,f=t?tt:r.dataSource??[],{preserveSelectedRowKeys:h,type:g,getCheckboxProps:d,onSelect:o,selections:c,hideSelectAll:m=!1,fixed:a="left",columnWidth:p,columnTitle:i,disableResize:y,checkStrictly:x,renderCell:L,onCell:W}=e||{},[R,F]=Qe(e,{defaultValuePropName:"defaultSelectedRowKeys",valuePropName:"selectedRowKeys",trigger:"onChange",defaultValue:[]}),Z=u.useCallback(v=>{const S=v[l];return R.includes(S)?"virtual-table-row-selected":""},[l,R]),$=f.map(v=>d?d(v):{}),I=de(()=>f.filter((v,S)=>!$[S].disabled).map(v=>v[l])),q=u.useRef(new Map),z=!$.some(v=>!v.disabled),_=we(v=>{const S=[];return v.forEach(j=>{let O=f.find(A=>A[l]===j);O==null&&h&&(O=q.current.get(j)),!(!O&&!h)&&S.push(O)}),S}),G=u.useMemo(()=>{if(t)return s;const v=g==="radio",S=R.length>0,j=S&&I.length>R.length,O=S?I.length>0&&I.every(b=>R.includes(b)):!1,A=b=>{const E=new Set(b);return h?Array.from(E):Array.from(E).filter(D=>I.includes(D))},U=()=>{const b=A([...R,...I]),E=_(b);F(b,E,{type:"all"})},ee=()=>{const b=I.filter(D=>!R.includes(D)),E=_(b);F(b,E,{type:"invert"})},J=()=>{F([],[],{type:"none"})};return[{title:m?void 0:(()=>{if(v)return u.isValidElement(i)?i:typeof i=="function"?i(void 0):null;let b=w.jsx(Ze,{checked:O,indeterminate:j,selections:c,onClear:J,onSelectAll:U,onSelectInvert:ee,allKeys:I,disabled:z,onChange:()=>{O?J():U()}});return u.isValidElement(i)?b=i:typeof i=="function"&&(b=i(b)),b})(),width:p??32,fixed:a===!1?void 0:a==="left"?"left":"right",key:et,disableResize:y,render(b,E,D){const V=E[l],C=R.includes(V),H=$[D],N=()=>{h&&q.current.set(V,E)};return w.jsx(Xe,{...H,index:D,isRadio:v,checked:C,record:E,renderCell:L,onRadioChange:k=>{N();const T=[V],P=_(T);o==null||o(E,k.target.checked,P,k),F(T,P,{type:"single"})},onCheckboxChange:k=>{if(N(),C){const T=A(R.filter(B=>B!==V)),P=_(T);o==null||o(E,k.target.checked,P,k),F(T,P,{type:"single"})}else{const T=A([...R,V]),P=_(T);o==null||o(E,k.target.checked,P,k),F(T,P,{type:"single"})}}})},onCell:W,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...s]},[t,y,z,I,i,p,a,_,m,W,o,h,s,L,l,R,$,c,F,g]);return t?r:{...r,rowClassName:Z,columns:G}}}function rt(e,n){if(typeof n=="number"&&Number.isFinite(n))return n;switch(e){case"small":return 39;case"large":return 65;default:return 57}}function st(e,n){const{size:r="middle",estimatedRowHeight:t,sticky:s,rowSelection:l,loading:f,bordered:h,pipeline:g,...d}=e,o=rt(r,t),c=Ne({pipeline:g,use:[nt(l)]});return w.jsx(Be,{...d,pipeline:c,rootClassName:M(`virtual-table-${r}`),ref:n,estimatedRowHeight:o,stickyHeader:typeof s=="boolean"?s:s==null?void 0:s.offsetHeader})}const ct=u.forwardRef(st);export{ct as V,Be as a,nt as s,Ne as u};
