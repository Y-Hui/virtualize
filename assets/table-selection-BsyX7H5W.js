import{r,j as C}from"./index-BAwjQ-7c.js";import{j as X,T as G,s as re,k as oe,d as ce,c as Z,l as ue,b as ie}from"./table-Byzm5jmz.js";function J(e){const n=e(),t=r.useRef(n);return X(n,t.current)||(t.current=n),t.current}function ee(e){const n={current:null,options:null};return(...t)=>{const o=c=>e(c,...t);return X(t,n.options)?n.current??o:(n.options=t,n.current=o,o)}}function Re(e){const{use:n,pipeline:t}=e,o=r.useMemo(()=>({current:new G}),[]);if(n!=null){const c=re([...n,...(t==null?void 0:t.hooks)??[]]);if(!oe(o.current.hooks,c)){const u=new G;return u.setHooks(c),o.current=u,u}}return o.current}function ae(e,n){const{valuePropName:t="value",defaultValue:o,trigger:c="onChange"}=n??{},u=t in e,p=e[t],y=p??o,[b,i]=r.useState(y),f=r.useRef(y);u&&(f.current=p);const l=e[c],h=r.useCallback((k,...E)=>{typeof k=="function"?l==null||l(k(f.current),...E):l==null||l(k,...E)},[l]);return u?[p,h]:[b,i]}function de(){const e=document.createElement("div");e.style.position="absolute",e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.top="-9999px",document.body.appendChild(e);const n=e.offsetWidth-e.clientWidth,t=e.offsetHeight-e.clientHeight;return document.body.removeChild(e),{width:n,height:t}}const fe=e=>{const{className:n,style:t,bottom:o,zIndex:c,bodyRef:u}=e,{addShouldSyncElement:p}=ce(),y=r.useRef(null);r.useEffect(()=>{const l=y.current;if(l!=null)return p("virtual-table-sticky-bottom-scroll",l)},[p]);const[b,i]=r.useState(0);r.useEffect(()=>{const l=u.current;if(l==null)return;const h=new ResizeObserver(k=>{const{width:E}=k[0].contentRect;i(E)});return h.observe(l),()=>{h.disconnect()}},[u]);const[f]=r.useState(de);return C.jsx("div",{className:Z("virtual-table-sticky-scroll",n),style:{...t,paddingTop:f.height>0?0:12,marginTop:f.height>0?0:f.height*-1,height:f.height,bottom:o,zIndex:c},ref:y,children:C.jsx("div",{className:"virtual-table-sticky-scroll-bar",style:{width:b}})})};function he(e,n){const{bodyRootRef:t}=e;return{...e,renderContent(o){return C.jsxs(C.Fragment,{children:[o,C.jsx(fe,{bodyRef:t,...n})]})}}}const Ce=ee(he);function me(e,n){const{className:t,multiple:o,indeterminate:c,value:u=!1,onChange:p,component:y,...b}=e,i=y!=null,f=r.useRef(null);r.useEffect(()=>{if(i)return;const h=f.current;h!=null&&(h.indeterminate=!!c)},[i,c]);const l=ue(f,n);return i?r.createElement(y,e):C.jsx("input",{...b,ref:l,className:Z("virtual-table-selection",t),type:o?"checkbox":"radio",checked:u,onChange:h=>{p==null||p(h.target.checked,h.nativeEvent)}})}const Q=r.forwardRef(me),pe="VirtualTable.SELECTION_COLUMN",ye=[];function be(e,n){const t=n==null,{columns:o}=e,c=e.rowKey,u=t?ye:e.dataSource,{defaultSelectedRowKeys:p,component:y,preserveSelectedRowKeys:b,multiple:i=!0,getSelectionProps:f,onSelect:l,hideSelectAll:h=!1,fixed:k,columnWidth:E,columnTitle:v,extraColumnProps:U,renderCell:_,onCell:q}=n??{},[d=[],N]=ae(n??{},{defaultValue:p,valuePropName:"selectedRowKeys",trigger:"onChange"}),te=r.useCallback(m=>{const R=m[c];return d.includes(R)?"virtual-table-row-selected":""},[c,d]),z=J(()=>u.map(m=>f?f(m):{})),w=J(()=>u.filter((m,R)=>!z[R].disabled).map(m=>m[c])),F=r.useRef(new Map),I=!z.some(m=>!m.disabled),j=ie(m=>{const R=[];return m.forEach(K=>{let g=u.find(L=>L[c]===K);g==null&&b&&(g=F.current.get(K)),!(g==null&&!b)&&R.push(g)}),R}),V=r.useRef(null),ne=r.useMemo(()=>{if(t)return o;const m=d.length>0,R=m&&w.length>d.length,K=m?w.length>0&&w.every(s=>d.includes(s)):!1,g=s=>{const a=new Set(s);return b?Array.from(a):Array.from(a).filter(S=>w.includes(S))},L=(s,a)=>{const S=V.current??s,x=Math.min(S,s),P=Math.max(S,s),H=w.slice(x,P+1),B=H.some(M=>!d.includes(M));V.current=B?P:null;const A=g(a?[...d,...H]:d.filter(M=>!H.includes(M))),T=j(A);N(A,T,{type:"multiple"})},O=()=>{const s=g([...d,...w]),a=j(s);N(s,a,{type:"all"})},se=()=>{const s=w.filter(S=>!d.includes(S)),a=j(s);N(s,a,{type:"invert"})},W=()=>{N([],[],{type:"none"})},Y={indeterminate:R,value:K,disabled:I,multiple:i,onChange:s=>{s?O():W()},onClear:W,onSelectAll:O,onSelectInvert:se,allKeys:w};return[{...U,title:h?void 0:(()=>{if(!i)return r.isValidElement(v)?v:typeof v=="function"?v(void 0,Y):null;let s=C.jsx("div",{className:"virtual-table-selection",children:C.jsx(Q,{component:y,multiple:i,value:K,indeterminate:R,disabled:I,onChange:a=>{a?O():W()}})});return r.isValidElement(v)?s=v:typeof v=="function"&&(s=v(s,Y)),s})(),width:E??32,align:"center",fixed:k?"left":void 0,key:pe,render(s,a,S){const x=a[c],P=d.includes(x),H=z[S],B=()=>{b&&F.current.set(x,a)},A=C.jsx(Q,{...H,component:y,value:P,multiple:i,onChange:(T,M)=>{if(B(),i&&M.shiftKey){L(S,T);return}T?V.current=S:V.current=null;let D=[x];i&&(D=g(T?[...d,x]:d.filter(le=>le!==x)));const $=j(D);l==null||l(a,T,$,M),N(D,$,{type:"single"})}});return typeof _=="function"?_(P,a,S,A):A},onCell:q,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...o]},[t,U,I,w,v,E,k,j,h,q,l,b,o,_,c,d,z,N,i,y]);return t?e:{...e,rowClassName:te,columns:ne}}const ke=ee(be);export{J as a,ae as b,ee as c,de as g,Ce as h,ke as t,Re as u};
