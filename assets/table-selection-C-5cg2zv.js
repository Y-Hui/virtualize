import{r,j as I}from"./index-Cr0JKDZg.js";import{s as ne,c as le,b as se,k as L,f as J,i as oe}from"./index-B30jz6yK.js";function re(c,C){const{valuePropName:d="value",defaultValue:b,trigger:u="onChange"}=C??{},g=d in c,m=c[d],y=m??b,[p,s]=r.useState(y),w=r.useRef(y);g&&(w.current=m);const n=c[u],i=r.useCallback((E,...P)=>{typeof E=="function"?n==null||n(E(w.current),...P):n==null||n(E,...P)},[n]);return g?[m,i]:[p,s]}function ce(c,C){const{className:d,multiple:b,indeterminate:u,value:g=!1,onChange:m,component:y,...p}=c,s=y!=null,w=r.useRef(null);r.useEffect(()=>{if(s)return;const i=w.current;i!=null&&(i.indeterminate=!!u)},[s,u]);const n=ne(w,C);return s?r.createElement(y,c):I.jsx("input",{...p,ref:n,className:le("virtual-table-selection",d),type:b?"checkbox":"radio",checked:g,onChange:i=>{m==null||m(i.target.checked,i.nativeEvent)}})}const Q=r.forwardRef(ce),ue="VirtualTable.SELECTION_COLUMN",ae=[];function ie(c,C){const d=C==null,{columns:b,rowKey:u}=c,g=d?ae:c.dataSource,{defaultSelectedRowKeys:m,component:y,preserveSelectedRowKeys:p,multiple:s=!0,getSelectionProps:w,onSelect:n,hideSelectAll:i=!1,fixed:E,columnWidth:P,columnTitle:v,extraColumnProps:W,renderCell:O,onCell:$}=C??{},[l=[],K]=re(C??{},{defaultValue:m,valuePropName:"selectedRowKeys",trigger:"onChange"}),X=r.useCallback(o=>{const h=L(o,u);return l.includes(h)?"virtual-table-row-selected":""},[u,l]),j=J(()=>g.map(o=>w?w(o):{})),S=J(()=>g.filter((o,h)=>!j[h].disabled).map(o=>L(o,u))),q=r.useRef(new Map),D=!j.some(o=>!o.disabled),x=oe(o=>{const h=[];return o.forEach(k=>{let f=g.find(U=>L(U,u)===k);f==null&&p&&(f=q.current.get(k)),!(f==null&&!p)&&h.push(f)}),h}),_=r.useRef(null),Z=r.useMemo(()=>{if(d)return b;const o=l.length>0,h=o&&S.length>l.length,k=o?S.length>0&&S.every(e=>l.includes(e)):!1,f=e=>{const t=new Set(e);return p?Array.from(t):Array.from(t).filter(a=>S.includes(a))},U=(e,t)=>{const a=_.current??e,R=Math.min(a,e),T=Math.max(a,e),A=S.slice(R,T+1),F=A.some(M=>!l.includes(M));_.current=F?T:null;const V=f(t?[...l,...A]:l.filter(M=>!A.includes(M))),N=x(V);K(V,N,{type:"multiple"})},Y=()=>{const e=f([...l,...S]),t=x(e);K(e,t,{type:"all"})},ee=()=>{const e=S.filter(a=>!l.includes(a)),t=x(e);K(e,t,{type:"invert"})},B=()=>{K([],[],{type:"none"})},z={indeterminate:h,value:k,disabled:D,multiple:s,onChange:e=>{e?Y():B()},onClear:B,onSelectAll:Y,onSelectInvert:ee,allKeys:S};return[{...W,title:i?void 0:(()=>{if(!s)return r.isValidElement(v)?v:typeof v=="function"?v(void 0,z):null;let e=I.jsx("div",{className:"virtual-table-selection",children:I.jsx(Q,{component:y,multiple:s,value:k,indeterminate:h,disabled:D,onChange:t=>{t?Y():B()}})});return r.isValidElement(v)?e=v:typeof v=="function"&&(e=v(e,z)),e})(),width:P??32,align:"center",fixed:E?"left":void 0,key:ue,render(e,t,a){const R=L(t,u),T=l.includes(R),A=j[a],F=()=>{p&&q.current.set(R,t)},V=I.jsx(Q,{...A,component:y,value:T,multiple:s,onChange:(N,M)=>{if(F(),s&&M.shiftKey){U(a,N);return}N?_.current=a:_.current=null;let H=[R];s&&(H=f(N?[...l,R]:l.filter(te=>te!==R)));const G=x(H);n==null||n(t,N,G,M),K(H,G,{type:"single"})}});return typeof O=="function"?O(T,t,a,V):V},onCell:$,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...b]},[d,W,D,S,v,P,E,x,i,$,n,p,b,O,u,l,j,K,s,y]);return d?c:{...c,rowClassName:X,columns:Z}}const pe=se(ie);export{pe as t,re as u};
