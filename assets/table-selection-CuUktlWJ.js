import{r as o,j as I}from"./index-DYv6-B4k.js";import{r as ne,c as le,a as se,i as L,e as J,f as re}from"./index-CwLu-TOC.js";function oe(c,C){const{valuePropName:d="value",defaultValue:R,trigger:u="onChange"}=C??{},g=d in c,m=c[d],y=m??R,[p,s]=o.useState(y),w=o.useRef(y);g&&(w.current=m);const n=c[u],i=o.useCallback((E,...P)=>{typeof E=="function"?n==null||n(E(w.current),...P):n==null||n(E,...P)},[n]);return g?[m,i]:[p,s]}function ce(c,C){const{className:d,multiple:R,indeterminate:u,value:g=!1,onChange:m,component:y,...p}=c,s=y!=null,w=o.useRef(null);o.useEffect(()=>{if(s)return;const i=w.current;i!=null&&(i.indeterminate=!!u)},[s,u]);const n=ne(w,C);return s?o.createElement(y,c):I.jsx("input",{...p,ref:n,className:le("virtual-table-selection",d),type:R?"checkbox":"radio",checked:g,onChange:i=>{m==null||m(i.target.checked,i.nativeEvent)}})}const Q=o.forwardRef(ce),ue="VirtualTable.SELECTION_COLUMN",ae=[];function ie(c,C){const d=C==null,{columns:R,rowKey:u}=c,g=d?ae:c.dataSource,{defaultSelectedRowKeys:m,component:y,preserveSelectedRowKeys:p,multiple:s=!0,getSelectionProps:w,onSelect:n,hideSelectAll:i=!1,fixed:E,columnWidth:P,columnTitle:S,extraColumnProps:W,renderCell:O,onCell:$}=C??{},[l=[],K]=oe(C??{},{defaultValue:m,valuePropName:"selectedRowKeys",trigger:"onChange"}),X=o.useCallback(r=>{const v=L(r,u);return l.includes(v)?"virtual-table-row-selected":""},[u,l]),j=J(()=>g.map(r=>w?w(r):{})),h=J(()=>g.filter((r,v)=>!j[v].disabled).map(r=>L(r,u))),q=o.useRef(new Map),D=!j.some(r=>!r.disabled),x=re(r=>{const v=[];return r.forEach(k=>{let f=g.find(U=>L(U,u)===k);f==null&&p&&(f=q.current.get(k)),!(f==null&&!p)&&v.push(f)}),v}),_=o.useRef(null),Z=o.useMemo(()=>{if(d)return R;const r=l.length>0,v=r&&h.length>l.length,k=r?h.length>0&&h.every(e=>l.includes(e)):!1,f=e=>{const t=new Set(e);return p?Array.from(t):Array.from(t).filter(a=>h.includes(a))},U=(e,t)=>{const a=_.current??e,b=Math.min(a,e),T=Math.max(a,e),A=h.slice(b,T+1),F=A.some(M=>!l.includes(M));_.current=F?T:null;const V=f(t?[...l,...A]:l.filter(M=>!A.includes(M))),N=x(V);K(V,N,{type:"multiple"})},Y=()=>{const e=f([...l,...h]),t=x(e);K(e,t,{type:"all"})},ee=()=>{const e=h.filter(a=>!l.includes(a)),t=x(e);K(e,t,{type:"invert"})},B=()=>{K([],[],{type:"none"})},z={indeterminate:v,value:k,disabled:D,multiple:s,onChange:e=>{e?Y():B()},onClear:B,onSelectAll:Y,onSelectInvert:ee,allKeys:h};return[{...W,title:i?void 0:(()=>{if(!s)return o.isValidElement(S)?S:typeof S=="function"?S(void 0,z):null;let e=I.jsx("div",{className:"virtual-table-selection",children:I.jsx(Q,{component:y,multiple:s,value:k,indeterminate:v,disabled:D,onChange:t=>{t?Y():B()}})});return o.isValidElement(S)?e=S:typeof S=="function"&&(e=S(e,z)),e})(),width:P??32,align:"center",fixed:E?"left":void 0,key:ue,render(e,t,a){const b=L(t,u),T=l.includes(b),A=j[a],F=()=>{p&&q.current.set(b,t)},V=I.jsx(Q,{...A,component:y,value:T,multiple:s,onChange:(N,M)=>{if(F(),s&&M.shiftKey){U(a,N);return}N?_.current=a:_.current=null;let H=[b];s&&(H=f(N?[...l,b]:l.filter(te=>te!==b)));const G=x(H);n==null||n(t,N,G,M),K(H,G,{type:"single"})}});return typeof O=="function"?O(T,t,a,V):V},onCell:$,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...R]},[d,W,D,h,S,P,E,x,i,$,n,p,R,O,u,l,j,K,s,y]);return d?c:{...c,rowClassName:X,columns:Z}}const pe=se(ie);export{pe as t,oe as u};
