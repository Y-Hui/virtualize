import{r,j as L}from"./index-BVhD4ibV.js";import{n as te,p as ne,c as le,a as se,e as re}from"./index-CgSmnyG9.js";function G(n){const a=n(),o=r.useRef(a);return te(a,o.current)||(o.current=a),o.current}function oe(n,a){const{valuePropName:o="value",defaultValue:R,trigger:i="onChange"}=a??{},C=o in n,p=n[o],y=p??R,[S,c]=r.useState(y),g=r.useRef(y);C&&(g.current=p);const l=n[i],d=r.useCallback((E,...P)=>{typeof E=="function"?l==null||l(E(g.current),...P):l==null||l(E,...P)},[l]);return C?[p,d]:[S,c]}function ce(n,a){const{className:o,multiple:R,indeterminate:i,value:C=!1,onChange:p,component:y,...S}=n,c=y!=null,g=r.useRef(null);r.useEffect(()=>{if(c)return;const d=g.current;d!=null&&(d.indeterminate=!!i)},[c,i]);const l=ne(g,a);return c?r.createElement(y,n):L.jsx("input",{...S,ref:l,className:le("virtual-table-selection",o),type:R?"checkbox":"radio",checked:C,onChange:d=>{p==null||p(d.target.checked,d.nativeEvent)}})}const J=r.forwardRef(ce),ue="VirtualTable.SELECTION_COLUMN",ae=[];function ie(n,a){const o=a==null,{columns:R}=n,i=n.rowKey,C=o?ae:n.dataSource,{defaultSelectedRowKeys:p,component:y,preserveSelectedRowKeys:S,multiple:c=!0,getSelectionProps:g,onSelect:l,hideSelectAll:d=!1,fixed:E,columnWidth:P,columnTitle:h,extraColumnProps:F,renderCell:I,onCell:H}=a??{},[s=[],K]=oe(a??{},{defaultValue:p,valuePropName:"selectedRowKeys",trigger:"onChange"}),Q=r.useCallback(u=>{const w=u[i];return s.includes(w)?"virtual-table-row-selected":""},[i,s]),j=G(()=>C.map(u=>g?g(u):{})),v=G(()=>C.filter((u,w)=>!j[w].disabled).map(u=>u[i])),W=r.useRef(new Map),O=!j.some(u=>!u.disabled),x=re(u=>{const w=[];return u.forEach(k=>{let m=C.find(D=>D[i]===k);m==null&&S&&(m=W.current.get(k)),!(m==null&&!S)&&w.push(m)}),w}),_=r.useRef(null),X=r.useMemo(()=>{if(o)return R;const u=s.length>0,w=u&&v.length>s.length,k=u?v.length>0&&v.every(e=>s.includes(e)):!1,m=e=>{const t=new Set(e);return S?Array.from(t):Array.from(t).filter(f=>v.includes(f))},D=(e,t)=>{const f=_.current??e,b=Math.min(f,e),T=Math.max(f,e),A=v.slice(b,T+1),q=A.some(M=>!s.includes(M));_.current=q?T:null;const V=m(t?[...s,...A]:s.filter(M=>!A.includes(M))),N=x(V);K(V,N,{type:"multiple"})},U=()=>{const e=m([...s,...v]),t=x(e);K(e,t,{type:"all"})},Z=()=>{const e=v.filter(f=>!s.includes(f)),t=x(e);K(e,t,{type:"invert"})},Y=()=>{K([],[],{type:"none"})},$={indeterminate:w,value:k,disabled:O,multiple:c,onChange:e=>{e?U():Y()},onClear:Y,onSelectAll:U,onSelectInvert:Z,allKeys:v};return[{...F,title:d?void 0:(()=>{if(!c)return r.isValidElement(h)?h:typeof h=="function"?h(void 0,$):null;let e=L.jsx("div",{className:"virtual-table-selection",children:L.jsx(J,{component:y,multiple:c,value:k,indeterminate:w,disabled:O,onChange:t=>{t?U():Y()}})});return r.isValidElement(h)?e=h:typeof h=="function"&&(e=h(e,$)),e})(),width:P??32,align:"center",fixed:E?"left":void 0,key:ue,render(e,t,f){const b=t[i],T=s.includes(b),A=j[f],q=()=>{S&&W.current.set(b,t)},V=L.jsx(J,{...A,component:y,value:T,multiple:c,onChange:(N,M)=>{if(q(),c&&M.shiftKey){D(f,N);return}N?_.current=f:_.current=null;let B=[b];c&&(B=m(N?[...s,b]:s.filter(ee=>ee!==b)));const z=x(B);l==null||l(t,N,z,M),K(B,z,{type:"single"})}});return typeof I=="function"?I(T,t,f,V):V},onCell:H,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...R]},[o,F,O,v,h,P,E,x,d,H,l,S,R,I,i,s,j,K,c,y]);return o?n:{...n,rowClassName:Q,columns:X}}const ye=se(ie);export{oe as a,ye as t,G as u};
