import{r,j as L}from"./index-By0mia_p.js";import{p as te,c as ne,a as le,e as G,f as se}from"./index-DRgzqceP.js";function oe(c,g){const{valuePropName:d="value",defaultValue:b,trigger:u="onChange"}=g??{},w=d in c,m=c[d],p=m??b,[y,s]=r.useState(p),C=r.useRef(p);w&&(C.current=m);const n=c[u],i=r.useCallback((E,...P)=>{typeof E=="function"?n==null||n(E(C.current),...P):n==null||n(E,...P)},[n]);return w?[m,i]:[y,s]}function re(c,g){const{className:d,multiple:b,indeterminate:u,value:w=!1,onChange:m,component:p,...y}=c,s=p!=null,C=r.useRef(null);r.useEffect(()=>{if(s)return;const i=C.current;i!=null&&(i.indeterminate=!!u)},[s,u]);const n=te(C,g);return s?r.createElement(p,c):L.jsx("input",{...y,ref:n,className:ne("virtual-table-selection",d),type:b?"checkbox":"radio",checked:w,onChange:i=>{m==null||m(i.target.checked,i.nativeEvent)}})}const J=r.forwardRef(re),ce="VirtualTable.SELECTION_COLUMN",ue=[];function ae(c,g){const d=g==null,{columns:b}=c,u=c.rowKey,w=d?ue:c.dataSource,{defaultSelectedRowKeys:m,component:p,preserveSelectedRowKeys:y,multiple:s=!0,getSelectionProps:C,onSelect:n,hideSelectAll:i=!1,fixed:E,columnWidth:P,columnTitle:S,extraColumnProps:H,renderCell:I,onCell:W}=g??{},[l=[],K]=oe(g??{},{defaultValue:m,valuePropName:"selectedRowKeys",trigger:"onChange"}),Q=r.useCallback(o=>{const v=o[u];return l.includes(v)?"virtual-table-row-selected":""},[u,l]),j=G(()=>w.map(o=>C?C(o):{})),h=G(()=>w.filter((o,v)=>!j[v].disabled).map(o=>o[u])),$=r.useRef(new Map),O=!j.some(o=>!o.disabled),T=se(o=>{const v=[];return o.forEach(k=>{let f=w.find(D=>D[u]===k);f==null&&y&&(f=$.current.get(k)),!(f==null&&!y)&&v.push(f)}),v}),_=r.useRef(null),X=r.useMemo(()=>{if(d)return b;const o=l.length>0,v=o&&h.length>l.length,k=o?h.length>0&&h.every(e=>l.includes(e)):!1,f=e=>{const t=new Set(e);return y?Array.from(t):Array.from(t).filter(a=>h.includes(a))},D=(e,t)=>{const a=_.current??e,R=Math.min(a,e),x=Math.max(a,e),A=h.slice(R,x+1),B=A.some(M=>!l.includes(M));_.current=B?x:null;const V=f(t?[...l,...A]:l.filter(M=>!A.includes(M))),N=T(V);K(V,N,{type:"multiple"})},U=()=>{const e=f([...l,...h]),t=T(e);K(e,t,{type:"all"})},Z=()=>{const e=h.filter(a=>!l.includes(a)),t=T(e);K(e,t,{type:"invert"})},Y=()=>{K([],[],{type:"none"})},q={indeterminate:v,value:k,disabled:O,multiple:s,onChange:e=>{e?U():Y()},onClear:Y,onSelectAll:U,onSelectInvert:Z,allKeys:h};return[{...H,title:i?void 0:(()=>{if(!s)return r.isValidElement(S)?S:typeof S=="function"?S(void 0,q):null;let e=L.jsx("div",{className:"virtual-table-selection",children:L.jsx(J,{component:p,multiple:s,value:k,indeterminate:v,disabled:O,onChange:t=>{t?U():Y()}})});return r.isValidElement(S)?e=S:typeof S=="function"&&(e=S(e,q)),e})(),width:P??32,align:"center",fixed:E?"left":void 0,key:ce,render(e,t,a){const R=t[u],x=l.includes(R),A=j[a],B=()=>{y&&$.current.set(R,t)},V=L.jsx(J,{...A,component:p,value:x,multiple:s,onChange:(N,M)=>{if(B(),s&&M.shiftKey){D(a,N);return}N?_.current=a:_.current=null;let F=[R];s&&(F=f(N?[...l,R]:l.filter(ee=>ee!==R)));const z=T(F);n==null||n(t,N,z,M),K(F,z,{type:"single"})}});return typeof I=="function"?I(x,t,a,V):V},onCell:W,onHeaderCell(){return{className:"virtual-table-selection-column"}}},...b]},[d,H,O,h,S,P,E,T,i,W,n,y,b,I,u,l,j,K,s,p]);return d?c:{...c,rowClassName:Q,columns:X}}const pe=le(ae);export{pe as t,oe as u};
